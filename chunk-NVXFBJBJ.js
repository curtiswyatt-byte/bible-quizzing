import{a as z}from"./chunk-KODUIQMG.js";import{c as k,f as F,j as V,k as A,l as $,p as W}from"./chunk-GJ3ACHC3.js";import{Ea as O,Fa as E,H as l,Ha as N,M as v,N as C,Na as I,R as g,W as d,X as o,Y as r,aa as P,ba as u,ca as y,d as m,ha as c,ia as h,ja as w,ka as M,na as _,oa as T,pa as b,y as f,z as S}from"./chunk-45QSGMLT.js";function Q(s,i){if(s&1&&(o(0,"option",18),c(1),r()),s&2){let e=i.$implicit;d("value",e),l(),h(e)}}function q(s,i){if(s&1&&(o(0,"option",18),c(1),r()),s&2){let e=i.$implicit;d("value",e),l(),h(e)}}function R(s,i){if(s&1){let e=P();o(0,"div",5)(1,"label",19),c(2,"Select Team:"),r(),o(3,"select",20),b("ngModelChange",function(n){f(e);let a=y();return T(a.selectedTeam,n)||(a.selectedTeam=n),S(n)}),u("change",function(){f(e);let n=y();return S(n.onTeamSelect())}),o(4,"option",8),c(5),r(),g(6,q,2,2,"option",9),r()()}if(s&2){let e=y();l(3),_("ngModel",e.selectedTeam),d("disabled",!e.selectedTournament||e.filteredTeams.length===0),l(2),h(e.selectedTournament?e.filteredTeams.length>0?"Select Team":"No teams with data":"Select a tournament first"),l(),d("ngForOf",e.filteredTeams)}}function B(s,i){if(s&1&&(o(0,"option",24),c(1),r()),s&2){let e=i.$implicit;d("ngValue",e),l(),M(" ",e.name," (",e.playerNumber,") ")}}function j(s,i){if(s&1){let e=P();o(0,"div",5)(1,"label",21),c(2,"Select Player:"),r(),o(3,"select",22),b("ngModelChange",function(n){f(e);let a=y();return T(a.selectedPlayer,n)||(a.selectedPlayer=n),S(n)}),u("change",function(){f(e);let n=y();return S(n.onPlayerSelect())}),o(4,"option",18),c(5),r(),g(6,B,2,3,"option",23),r()()}if(s&2){let e=y();l(3),_("ngModel",e.selectedPlayer),d("disabled",!e.selectedTournament||e.filteredPlayers.length===0),l(),d("value",null),l(),h(e.selectedTournament?e.filteredPlayers.length>0?"Select Player":"No players with data":"Select a tournament first"),l(),d("ngForOf",e.filteredPlayers)}}function L(s,i){s&1&&(o(0,"span"),c(1," Primary Bonus Out"),r())}var D=class s{constructor(i,e){this.dbService=i;this.router=e}tournaments=[];teams=[];players=[];filteredTeams=[];filteredPlayers=[];selectedTournament="";selectedTeam="";selectedPlayer=null;statType="team";displayText="";stats=[];ngOnInit(){return m(this,null,function*(){yield this.loadTournaments(),yield this.loadTeams(),yield this.loadPlayers()})}loadTournaments(){return m(this,null,function*(){let i=yield this.getAllMatchSummaries(),e=new Set;i.forEach(t=>e.add(t.quizID)),this.tournaments=Array.from(e).sort()})}getAllMatchSummaries(){return m(this,null,function*(){return yield this.dbService.getAllMatchSummaries()})}loadTeams(){return m(this,null,function*(){this.teams=yield this.dbService.getAllTeams(),this.teams.sort()})}loadPlayers(){return m(this,null,function*(){this.players=yield this.dbService.getAllPlayers(),this.players.sort((i,e)=>i.name.localeCompare(e.name))})}onTournamentSelect(){return m(this,null,function*(){this.selectedTeam="",this.selectedPlayer=null,this.displayText="",this.selectedTournament?yield this.filterTeamsAndPlayers():(this.filteredTeams=[],this.filteredPlayers=[])})}filterTeamsAndPlayers(){return m(this,null,function*(){if(!this.selectedTournament){this.filteredTeams=[],this.filteredPlayers=[];return}let i=yield this.dbService.getAllMatchStatsForTournament(this.selectedTournament),e=new Set;i.forEach(n=>{e.add(n.playerNumber)}),this.filteredPlayers=this.players.filter(n=>e.has(n.playerNumber));let t=new Set;for(let n of e){let a=yield this.dbService.getPlayer(n);a&&a.team&&t.add(a.team)}this.filteredTeams=Array.from(t).sort()})}onTeamSelect(){return m(this,null,function*(){this.selectedTeam&&this.selectedTournament&&(yield this.loadTeamStats())})}onPlayerSelect(){return m(this,null,function*(){this.selectedPlayer&&this.selectedTournament&&(yield this.loadPlayerStats())})}loadStats(){return m(this,null,function*(){this.statType==="team"?yield this.loadTeamStats():yield this.loadPlayerStats()})}loadTeamStats(){return m(this,null,function*(){if(!this.selectedTeam||!this.selectedTournament)return;this.displayText=`Team Statistics for ${this.selectedTeam}
`,this.displayText+=`Tournament: ${this.selectedTournament}

`,this.displayText+=`#    Name                           Act. Cor Err Foul  %    Cor Err   %   Quiz Err
`,this.displayText+=`                                            Primary           Bonus          Out
`;let i=yield this.dbService.getTeamMembers(this.selectedTeam);for(let e of i){let t=yield this.dbService.getPlayer(e);if(t){let n=yield this.getPlayerTournamentStats(e,this.selectedTournament);this.displayText+=this.formatPlayerStats(t,n)}}})}loadPlayerStats(){return m(this,null,function*(){if(!this.selectedPlayer||!this.selectedTournament)return;let i=yield this.getPlayerTournamentStats(this.selectedPlayer.playerNumber,this.selectedTournament);this.displayText=`Player Statistics for ${this.selectedPlayer.name}
`,this.displayText+=`Tournament: ${this.selectedTournament}

`,this.displayText+=this.formatPlayerStats(this.selectedPlayer,i)})}getPlayerTournamentStats(i,e){return m(this,null,function*(){let n=(yield this.dbService.getAllMatchStatsForTournament(e)).filter(p=>p.playerNumber===i),a={activeQuestions:0,correct:0,errors:0,fouls:0,bonusCorrect:0,bonusErrors:0,quizOut:0,errOut:0};n.forEach(p=>{a.activeQuestions+=p.activeQuestions,a.correct+=p.correct,a.errors+=p.errors,a.fouls+=p.fouls,a.bonusCorrect+=p.bonusCorrect,a.bonusErrors+=p.bonusErrors});let x=yield this.dbService.getUserFile();if(x){let p=yield this.dbService.getParms(x.book);p&&(a.quizOut=Math.floor(a.correct/p.quizOutNum),a.errOut=a.errors>=p.errOutNum?1:0)}return a})}formatPlayerStats(i,e){let t=e.activeQuestions>0?Math.round(e.correct/e.activeQuestions*100):0,n=e.bonusCorrect+e.bonusErrors>0?Math.round(e.bonusCorrect/(e.bonusCorrect+e.bonusErrors)*100):0;return`${i.playerNumber.toString().padStart(3)} ${i.name.padEnd(30)} ${e.activeQuestions.toString().padStart(4)} ${e.correct.toString().padStart(3)} ${e.errors.toString().padStart(3)} ${e.fouls.toString().padStart(3)} ${t.toString().padStart(3)}% ${e.bonusCorrect.toString().padStart(3)} ${e.bonusErrors.toString().padStart(3)} ${n.toString().padStart(3)}% ${e.quizOut.toString().padStart(2)} ${e.errOut.toString().padStart(2)}
`}onClear(){this.displayText="",this.selectedTeam="",this.selectedPlayer=null}onPrint(){window.print()}onReturn(){this.router.navigate(["/"])}static \u0275fac=function(e){return new(e||s)(v(z),v(I))};static \u0275cmp=C({type:s,selectors:[["app-statistics"]],decls:28,vars:7,consts:[[1,"statistics-container"],[1,"statistics-header"],[1,"btn","btn-secondary",3,"click"],[1,"statistics-content"],[1,"filter-section"],[1,"form-group"],["for","tournament",1,"form-label"],["id","tournament","name","selectedTournament",1,"form-control",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","form-group",4,"ngIf"],[1,"display-section"],[1,"stats-header"],[4,"ngIf"],[1,"stats-display"],[1,"stats-text"],[1,"action-section"],[1,"btn",3,"click"],[3,"value"],["for","team",1,"form-label"],["id","team","name","selectedTeam",1,"form-control",3,"ngModelChange","change","ngModel","disabled"],["for","player",1,"form-label"],["id","player","name","selectedPlayer",1,"form-control",3,"ngModelChange","change","ngModel","disabled"],[3,"ngValue",4,"ngFor","ngForOf"],[3,"ngValue"]],template:function(e,t){e&1&&(o(0,"div",0)(1,"div",1)(2,"h1"),c(3),r(),o(4,"button",2),u("click",function(){return t.onReturn()}),c(5,"Return"),r()(),o(6,"div",3)(7,"div",4)(8,"div",5)(9,"label",6),c(10,"Select Tournament:"),r(),o(11,"select",7),b("ngModelChange",function(a){return T(t.selectedTournament,a)||(t.selectedTournament=a),a}),u("change",function(){return t.onTournamentSelect()}),o(12,"option",8),c(13,"Select Tournament"),r(),g(14,Q,2,2,"option",9),r()(),g(15,R,7,4,"div",10)(16,j,7,5,"div",10),r(),o(17,"div",11)(18,"div",12),g(19,L,2,0,"span",13),r(),o(20,"div",14)(21,"pre",15),c(22),r()()(),o(23,"div",16)(24,"button",2),u("click",function(){return t.onClear()}),c(25,"Clear Display"),r(),o(26,"button",17),u("click",function(){return t.onPrint()}),c(27,"Print"),r()()()()),e&2&&(l(3),w("Statistics ",t.statType==="team"?"by Teams":"by Player"),l(8),_("ngModel",t.selectedTournament),l(3),d("ngForOf",t.tournaments),l(),d("ngIf",t.statType==="team"),l(),d("ngIf",t.statType==="player"),l(3),d("ngIf",t.statType==="team"),l(3),h(t.displayText))},dependencies:[N,O,E,W,A,$,V,k,F],styles:[".statistics-container[_ngcontent-%COMP%]{min-height:100vh;background-color:var(--xl-gray-light);padding:2rem}.statistics-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.statistics-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:var(--font-heading);font-size:2rem;color:var(--xl-blue-dark)}.statistics-content[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.filter-section[_ngcontent-%COMP%]{background-color:var(--xl-white);border-radius:8px;padding:1.5rem;margin-bottom:1rem;box-shadow:0 2px 4px #0000001a;display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem}.display-section[_ngcontent-%COMP%]{background-color:var(--xl-white);border-radius:8px;padding:1.5rem;margin-bottom:1rem;box-shadow:0 2px 4px #0000001a}.stats-header[_ngcontent-%COMP%]{font-family:Courier New,monospace;font-size:.875rem;margin-bottom:.5rem;color:var(--xl-gray-dark)}.stats-display[_ngcontent-%COMP%]{max-height:500px;overflow-y:auto;border:1px solid var(--xl-gray-light);border-radius:4px;padding:1rem;background-color:var(--xl-white)}.stats-text[_ngcontent-%COMP%]{font-family:Courier New,monospace;font-size:.875rem;margin:0;white-space:pre-wrap;word-wrap:break-word}.action-section[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:1rem}@media (max-width: 768px){.statistics-container[_ngcontent-%COMP%]{padding:1rem}.filter-section[_ngcontent-%COMP%]{grid-template-columns:1fr}}@media print{.statistics-header[_ngcontent-%COMP%], .filter-section[_ngcontent-%COMP%], .action-section[_ngcontent-%COMP%]{display:none}.stats-display[_ngcontent-%COMP%]{max-height:none;overflow:visible}}"]})};export{D as StatisticsComponent};
