import{a as y,c as h,d as i,s as S}from"./chunk-45QSGMLT.js";var P=class b{dbName="BibleQuizzingDB";dbVersion=5;db=null;getDatabase(){return i(this,null,function*(){if(yield this.init(),!this.db)throw new Error("Database not initialized");return this.db})}init(){return i(this,null,function*(){if(this.db){if(this.db.objectStoreNames.contains("tournaments"))return Promise.resolve();this.db.close(),this.db=null}return new Promise((s,o)=>{let t=indexedDB.open(this.dbName,this.dbVersion);t.onerror=()=>o(t.error),t.onsuccess=()=>{this.db=t.result,s()},t.onupgradeneeded=e=>{let r=e.target.result,n=e.target.transaction;if(!r.objectStoreNames.contains("players")){let a=r.createObjectStore("players",{keyPath:"playerNumber"});a.createIndex("name","name",{unique:!1}),a.createIndex("team","team",{unique:!1})}if(r.objectStoreNames.contains("teams")||r.createObjectStore("teams",{keyPath:["teamName","playerNumber"]}).createIndex("teamName","teamName",{unique:!1}),r.objectStoreNames.contains("questionDetail"))try{let a=n.objectStore("questionDetail");a.indexNames.contains("book")||a.createIndex("book","book",{unique:!1}),a.indexNames.contains("version")||a.createIndex("version","version",{unique:!1})}catch{console.log("Note: Could not add indices to questionDetail store (may already exist)")}else{let a=r.createObjectStore("questionDetail",{keyPath:"questionID"});a.createIndex("qDescType","qDescType",{unique:!1}),a.createIndex("book","book",{unique:!1}),a.createIndex("version","version",{unique:!1})}if(r.objectStoreNames.contains("questionSelect")||r.createObjectStore("questionSelect",{keyPath:"selectionID"}),!r.objectStoreNames.contains("quizSet"))r.createObjectStore("quizSet",{keyPath:["setID","questNum"]}).createIndex("setID","setID",{unique:!1});else try{let a=n.objectStore("quizSet");a.indexNames.contains("setID")||a.createIndex("setID","setID",{unique:!1})}catch{console.log("Note: Could not add index to quizSet store (may already exist)")}if(r.objectStoreNames.contains("verses")||r.createObjectStore("verses",{keyPath:["chapter","verse"]}),r.objectStoreNames.contains("types")||r.createObjectStore("types",{keyPath:"typeID"}),r.objectStoreNames.contains("parms")||r.createObjectStore("parms",{keyPath:"book"}),r.objectStoreNames.contains("matchSummary")||r.createObjectStore("matchSummary",{keyPath:["quizID","matchID"]}),r.objectStoreNames.contains("matchDetail")||r.createObjectStore("matchDetail",{keyPath:["quizID","matchID","seqNum"]}),r.objectStoreNames.contains("matchStats")||r.createObjectStore("matchStats",{keyPath:["playerNumber","quizID","matchID"]}),r.objectStoreNames.contains("userFile")||r.createObjectStore("userFile",{keyPath:"id"}),!r.objectStoreNames.contains("tournaments")){let a=r.createObjectStore("tournaments",{keyPath:"tournamentID"});a.createIndex("status","status",{unique:!1}),a.createIndex("createdAt","createdAt",{unique:!1})}}})})}initializeDefaultTypes(){return i(this,null,function*(){if((yield this.getAllTypes()).length>0)return;let o=[{typeID:"IC",class:"B",leadIn:"an Incomplete Chapter"},{typeID:"MC",class:"B",leadIn:"a Multiple Choice Chapter"},{typeID:"FC",class:"B",leadIn:"a Fill-in-the-blank Chapter"},{typeID:"IV",class:"B",leadIn:"an Incomplete Verse"},{typeID:"MV",class:"B",leadIn:"a Multiple Choice Verse"},{typeID:"Q",class:"Q",leadIn:"a Quote"}];for(let t of o)yield this.addType(t)})}addType(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["types"],"readwrite"),r=e.objectStore("types").put(s);r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}addPlayer(s){return i(this,null,function*(){return yield this.init(),new Promise((o,t)=>{let e=this.db.transaction(["players"],"readwrite"),r=e.objectStore("players").put(s);r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}getPlayer(s){return i(this,null,function*(){return yield this.init(),new Promise((o,t)=>{let e=this.db.transaction(["players"],"readonly"),r=e.objectStore("players").get(s);r.onsuccess=()=>o(r.result||null),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}getAllPlayers(){return i(this,null,function*(){return yield this.init(),new Promise((s,o)=>{let t=this.db.transaction(["players"],"readonly"),e=t.objectStore("players").getAll();e.onsuccess=()=>s(e.result),e.onerror=()=>o(e.error),t.onerror=()=>o(t.error)})})}deletePlayer(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["players"],"readwrite"),r=e.objectStore("players").delete(s);r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}addTeamMember(s,o){return i(this,null,function*(){return yield this.init(),new Promise((t,e)=>{let r=this.db.transaction(["teams"],"readwrite"),n=r.objectStore("teams").put({teamName:s,playerNumber:o});n.onsuccess=()=>t(),n.onerror=()=>e(n.error),r.onerror=()=>e(r.error)})})}getTeamMembers(s){return i(this,null,function*(){return yield this.init(),new Promise((o,t)=>{let e=this.db.transaction(["teams"],"readonly"),r=e.objectStore("teams").index("teamName"),n=IDBKeyRange.only(s),a=r.getAll(n);a.onsuccess=()=>o(a.result.map(c=>c.playerNumber)),a.onerror=()=>t(a.error),e.onerror=()=>t(e.error)})})}getAllTeams(){return i(this,null,function*(){return yield this.init(),new Promise((s,o)=>{let t=this.db.transaction(["teams"],"readonly"),e=t.objectStore("teams").getAll();e.onsuccess=()=>{let r=new Set;e.result.forEach(n=>r.add(n.teamName)),s(Array.from(r))},e.onerror=()=>o(e.error),t.onerror=()=>o(t.error)})})}removeTeamMember(s,o){return i(this,null,function*(){return yield this.init(),new Promise((t,e)=>{let r=this.db.transaction(["teams"],"readwrite"),n=r.objectStore("teams").delete([s,o]);n.onsuccess=()=>t(),n.onerror=()=>e(n.error),r.onerror=()=>e(r.error)})})}renameTeam(s,o){return i(this,null,function*(){let t=yield this.getTeamMembers(s);return new Promise((e,r)=>{let n=this.db.transaction(["teams"],"readwrite"),a=n.objectStore("teams"),c=0,u=t.length*2;if(u===0){e();return}let m=()=>{c++,c===u&&e()};t.forEach(l=>{let d=a.delete([s,l]);d.onsuccess=m,d.onerror=()=>r(d.error)}),t.forEach(l=>{let d=a.put({teamName:o,playerNumber:l});d.onsuccess=m,d.onerror=()=>r(d.error)}),n.onerror=()=>r(n.error)})})}addQuestion(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["questionDetail"],"readwrite"),r=e.objectStore("questionDetail").put(s);r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}getQuestion(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["questionDetail"],"readonly"),r=e.objectStore("questionDetail").get(s);r.onsuccess=()=>o(r.result||null),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}getAllQuestions(){return i(this,null,function*(){return new Promise((s,o)=>{let t=this.db.transaction(["questionDetail"],"readonly"),e=t.objectStore("questionDetail").getAll();e.onsuccess=()=>s(e.result),e.onerror=()=>o(e.error),t.onerror=()=>o(t.error)})})}deleteQuestion(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["questionDetail","questionSelect"],"readwrite"),r=e.objectStore("questionDetail").delete(s),n=e.objectStore("questionSelect").delete(s),a=0,c=()=>{a++,a===2&&o()};r.onsuccess=c,n.onsuccess=c,r.onerror=()=>t(r.error),n.onerror=()=>t(n.error),e.onerror=()=>t(e.error)})})}getVerse(s,o){return i(this,null,function*(){return new Promise((t,e)=>{let r=this.db.transaction(["verses"],"readonly"),n=r.objectStore("verses").get([s,o]);n.onsuccess=()=>t(n.result||null),n.onerror=()=>e(n.error),r.onerror=()=>e(r.error)})})}getVerses(s,o,t){return i(this,null,function*(){let e=[];for(let a=o;a<=t;a++)e.push(this.getVerse(s,a));return(yield Promise.all(e)).filter(a=>a!==null).map(a=>a.text).join(" ")})}addVerse(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["verses"],"readwrite"),r=e.objectStore("verses").put(s);r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}addQuestionSelect(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["questionSelect"],"readwrite"),r=e.objectStore("questionSelect").put(s);r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}getQuestionSelect(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["questionSelect"],"readonly"),r=e.objectStore("questionSelect").get(s);r.onsuccess=()=>o(r.result||null),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}getAllQuestionSelect(){return i(this,null,function*(){return new Promise((s,o)=>{let t=this.db.transaction(["questionSelect"],"readonly"),e=t.objectStore("questionSelect").getAll();e.onsuccess=()=>s(e.result||[]),e.onerror=()=>o(e.error),t.onerror=()=>o(t.error)})})}addQuizSetItem(s,o,t){return i(this,null,function*(){return new Promise((e,r)=>{let n=this.db.transaction(["quizSet"],"readwrite"),a=n.objectStore("quizSet").put({setID:s,questNum:o,bonusNum:t});a.onsuccess=()=>e(),a.onerror=()=>r(a.error),n.onerror=()=>r(n.error)})})}batchAddQuizSets(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["quizSet"],"readwrite"),r=e.objectStore("quizSet"),n=0,a=s.length;if(a===0){o();return}s.forEach(c=>{let u=r.put({setID:c.setID,questNum:c.questNum,bonusNum:c.bonusNum});u.onsuccess=()=>{n++,n===a&&o()},u.onerror=()=>t(u.error)}),e.onerror=()=>t(e.error)})})}getQuizSet(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["quizSet"],"readonly"),r=e.objectStore("quizSet");try{if(r.indexNames.contains("setID")){let n=r.index("setID"),a=IDBKeyRange.only(s),c=n.getAll(a);c.onsuccess=()=>{let u=c.result.map(m=>({setID:m.setID,questNum:m.questNum,bonusNum:m.bonusNum}));o(u)},c.onerror=()=>t(c.error)}else{let n=r.getAll();n.onsuccess=()=>{let a=n.result.filter(c=>c.setID===s).map(c=>({setID:c.setID,questNum:c.questNum,bonusNum:c.bonusNum}));o(a)},n.onerror=()=>t(n.error)}}catch{let a=r.getAll();a.onsuccess=()=>{let c=a.result.filter(u=>u.setID===s).map(u=>({setID:u.setID,questNum:u.questNum,bonusNum:u.bonusNum}));o(c)},a.onerror=()=>t(a.error)}e.onerror=()=>t(e.error)})})}getAllQuizSets(){return i(this,null,function*(){return new Promise((s,o)=>{let t=this.db.transaction(["quizSet"],"readonly"),e=t.objectStore("quizSet").getAll();e.onsuccess=()=>{let r=new Set;e.result.forEach(n=>{n.setID&&r.add(n.setID)}),s(Array.from(r))},e.onerror=()=>o(e.error),t.onerror=()=>o(t.error)})})}getQuizSetItems(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["quizSet"],"readonly"),n=e.objectStore("quizSet").index("setID"),a=IDBKeyRange.only(s),c=n.getAll(a);c.onsuccess=()=>o(c.result||[]),c.onerror=()=>t(c.error),e.onerror=()=>t(e.error)})})}getAllTypes(){return i(this,null,function*(){return new Promise((s,o)=>{let t=this.db.transaction(["types"],"readonly"),e=t.objectStore("types").getAll();e.onsuccess=()=>s(e.result),e.onerror=()=>o(e.error),t.onerror=()=>o(t.error)})})}getParms(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["parms"],"readonly"),r=e.objectStore("parms").get(s);r.onsuccess=()=>o(r.result||null),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}saveParms(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["parms"],"readwrite"),r=e.objectStore("parms").put(s);r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}saveMatchSummary(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["matchSummary"],"readwrite"),r=e.objectStore("matchSummary").put(s);r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}getMatchSummary(s,o){return i(this,null,function*(){return new Promise((t,e)=>{let r=this.db.transaction(["matchSummary"],"readonly"),n=r.objectStore("matchSummary").get([s,o]);n.onsuccess=()=>t(n.result||null),n.onerror=()=>e(n.error),r.onerror=()=>e(r.error)})})}getAllMatchSummaries(){return i(this,null,function*(){return new Promise((s,o)=>{let t=this.db.transaction(["matchSummary"],"readonly"),e=t.objectStore("matchSummary").getAll();e.onsuccess=()=>s(e.result),e.onerror=()=>o(e.error),t.onerror=()=>o(t.error)})})}addMatchDetail(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["matchDetail"],"readwrite"),r=e.objectStore("matchDetail").put(s);r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}getMatchDetails(s,o){return i(this,null,function*(){return new Promise((t,e)=>{let r=this.db.transaction(["matchDetail"],"readonly"),n=r.objectStore("matchDetail").getAll();n.onsuccess=()=>t(n.result.filter(a=>a.quizID===s&&a.matchID===o)),n.onerror=()=>e(n.error),r.onerror=()=>e(r.error)})})}saveMatchStats(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["matchStats"],"readwrite"),r=e.objectStore("matchStats").put(s);r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}getMatchStats(s,o,t){return i(this,null,function*(){return new Promise((e,r)=>{let n=this.db.transaction(["matchStats"],"readonly"),a=n.objectStore("matchStats").get([s,o,t]);a.onsuccess=()=>e(a.result||null),a.onerror=()=>r(a.error),n.onerror=()=>r(n.error)})})}getAllMatchStatsForTournament(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["matchStats"],"readonly"),r=e.objectStore("matchStats").getAll();r.onsuccess=()=>o(r.result.filter(n=>n.quizID===s)),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}getUserFile(){return i(this,null,function*(){return new Promise((s,o)=>{let t=this.db.transaction(["userFile"],"readonly"),e=t.objectStore("userFile").get("current");e.onsuccess=()=>{let r=e.result;if(r){let n=r,{id:a}=n,c=h(n,["id"]);s(c)}else s(null)},e.onerror=()=>o(e.error),t.onerror=()=>o(t.error)})})}saveUserFile(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["userFile"],"readwrite"),r=e.objectStore("userFile").put(y({id:"current"},s));r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}clearAllData(){return i(this,null,function*(){yield this.init();let s=["players","teams","questionDetail","questionSelect","quizSet","verses","types","parms","matchSummary","matchDetail","matchStats","userFile"];return new Promise((o,t)=>{try{let e=this.db.transaction(s,"readwrite");s.forEach(r=>{e.objectStore(r).clear()}),e.oncomplete=()=>o(),e.onerror=()=>t(e.error)}catch(e){t(e)}})})}batchAddPlayers(s){return i(this,null,function*(){if(!this.db)throw new Error("Database not initialized");return new Promise((o,t)=>{let e=this.db.transaction(["players"],"readwrite"),r=e.objectStore("players"),n=0,a=!1,c=s.length;if(c===0){o();return}e.oncomplete=()=>{a||(console.log(`\u2705 Transaction completed: ${n}/${c} players saved`),o())},e.onerror=()=>{a=!0,console.error("Transaction error:",e.error),t(e.error)},s.forEach((u,m)=>{if(!u.playerNumber||isNaN(u.playerNumber)){console.warn(`Skipping invalid player at index ${m}:`,u),n++;return}let l=r.put(u);l.onsuccess=()=>{n++},l.onerror=()=>{a=!0,console.error(`Error saving player ${u.playerNumber}:`,l.error),t(l.error)}})})})}batchAddVerses(s){return i(this,null,function*(){return new Promise((o,t)=>{let e=this.db.transaction(["verses"],"readwrite"),r=e.objectStore("verses"),n=0,a=s.length;if(a===0){o();return}s.forEach(c=>{let u=r.put(c);u.onsuccess=()=>{n++,n===a&&o()},u.onerror=()=>t(u.error)}),e.onerror=()=>t(e.error)})})}batchAddQuestions(s){return i(this,null,function*(){if(!this.db)throw new Error("Database not initialized");return new Promise((o,t)=>{let e=this.db.transaction(["questionDetail"],"readwrite"),r=e.objectStore("questionDetail"),n=0,a=!1,c=s.length;if(c===0){o();return}e.oncomplete=()=>{a||(console.log(`\u2705 Transaction completed: ${n}/${c} questions saved`),o())},e.onerror=()=>{a=!0,console.error("Transaction error:",e.error),t(e.error)},s.forEach((u,m)=>{if(!u.questionID||isNaN(u.questionID)||u.questionID<=0){console.warn(`Skipping invalid question at index ${m}:`,u),n++;return}let l=r.put(u);l.onsuccess=()=>{n++},l.onerror=()=>{a=!0,console.error(`Error saving question ${u.questionID}:`,l.error),t(l.error)}})})})}addTournament(s){return i(this,null,function*(){return yield this.init(),new Promise((o,t)=>{let e=this.db.transaction(["tournaments"],"readwrite"),r=e.objectStore("tournaments").add(s);r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}getTournament(s){return i(this,null,function*(){return yield this.init(),new Promise((o,t)=>{let r=this.db.transaction(["tournaments"],"readonly").objectStore("tournaments").get(s);r.onsuccess=()=>o(r.result||null),r.onerror=()=>t(r.error)})})}updateTournament(s){return i(this,null,function*(){return yield this.init(),new Promise((o,t)=>{let e=this.db.transaction(["tournaments"],"readwrite"),r=e.objectStore("tournaments").put(s);r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}deleteTournament(s){return i(this,null,function*(){return yield this.init(),new Promise((o,t)=>{let e=this.db.transaction(["tournaments"],"readwrite"),r=e.objectStore("tournaments").delete(s);r.onsuccess=()=>o(),r.onerror=()=>t(r.error),e.onerror=()=>t(e.error)})})}getAllTournaments(){return i(this,null,function*(){return yield this.init(),new Promise((s,o)=>{let e=this.db.transaction(["tournaments"],"readonly").objectStore("tournaments").getAll();e.onsuccess=()=>s(e.result||[]),e.onerror=()=>o(e.error)})})}getTournamentsByStatus(s){return i(this,null,function*(){return yield this.init(),new Promise((o,t)=>{let n=this.db.transaction(["tournaments"],"readonly").objectStore("tournaments").index("status").getAll(s);n.onsuccess=()=>o(n.result||[]),n.onerror=()=>t(n.error)})})}static \u0275fac=function(o){return new(o||b)};static \u0275prov=S({token:b,factory:b.\u0275fac,providedIn:"root"})};export{P as a};
