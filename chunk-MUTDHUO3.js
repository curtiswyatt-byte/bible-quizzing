import{a as q}from"./chunk-KODUIQMG.js";import{b as I,c as N,f as z,p as R}from"./chunk-GJ3ACHC3.js";import{Ea as D,Fa as k,H as o,Ha as S,M as _,N as P,Na as E,R as b,W as c,X as a,Y as n,aa as C,ba as x,ca as d,d as p,fa as M,ha as r,ia as g,ja as u,ka as y,na as w,oa as O,pa as T,y as h,z as f}from"./chunk-45QSGMLT.js";function V(i,t){i&1&&(a(0,"div",9)(1,"p"),r(2,"Loading database information..."),n()())}function F(i,t){if(i&1&&(a(0,"div",29)(1,"strong"),r(2,"Indices:"),n(),r(3),n()),i&2){let e=d().$implicit;o(3),u(" ",e.indices.join(", ")," ")}}function Q(i,t){if(i&1&&(a(0,"div",30)(1,"strong"),r(2,"Related:"),n(),r(3),n()),i&2){let e=d().$implicit;o(3),u(" ",e.relatedTables.join(", ")," ")}}function $(i,t){if(i&1){let e=C();a(0,"div",20),x("click",function(){let s=h(e).$implicit,v=d(2);return f(v.selectTable(s))}),a(1,"div",21),r(2),n(),a(3,"div",22)(4,"h3"),r(5),n(),a(6,"p",23),r(7),n(),a(8,"div",24)(9,"span",25),r(10),n(),a(11,"span",26),r(12),n()(),b(13,F,4,1,"div",27)(14,Q,4,1,"div",28),n()()}if(i&2){let e=t.$implicit;M("empty",e.recordCount===0),o(2),g(e.icon),o(3),g(e.displayName),o(2),g(e.description),o(3),u("",e.recordCount," records"),o(2),u("Key: ",e.keyPath),o(),c("ngIf",e.indices.length>0),o(),c("ngIf",e.relatedTables.length>0)}}function B(i,t){if(i&1&&(a(0,"div",10)(1,"div",11)(2,"h2"),r(3,"Database Schema"),n(),a(4,"p",12),r(5,"Click on any table to view its data"),n()(),a(6,"div",13),b(7,$,15,9,"div",14),n(),a(8,"div",15)(9,"h3"),r(10,"Database Statistics"),n(),a(11,"div",16)(12,"div",17)(13,"div",18),r(14),n(),a(15,"div",19),r(16,"Tables"),n()(),a(17,"div",17)(18,"div",18),r(19),n(),a(20,"div",19),r(21,"Total Records"),n()(),a(22,"div",17)(23,"div",18),r(24),n(),a(25,"div",19),r(26,"Total Indices"),n()()()()()),i&2){let e=d();o(7),c("ngForOf",e.tables),o(7),g(e.tables.length),o(5),g(e.totalRecords),o(5),g(e.totalIndices)}}function U(i,t){if(i&1&&(a(0,"th"),r(1),n()),i&2){let e=t.$implicit;o(),g(e)}}function A(i,t){if(i&1&&(a(0,"td")(1,"span",45),r(2),n()()),i&2){let e=t.$implicit,l=d().$implicit,s=d(3);o(2),g(s.formatValue(l[e]))}}function J(i,t){if(i&1&&(a(0,"tr"),b(1,A,3,1,"td",44),n()),i&2){let e=d(3);o(),c("ngForOf",e.tableData.columns)}}function W(i,t){if(i&1&&(a(0,"div",42)(1,"table",43)(2,"thead")(3,"tr"),b(4,U,2,1,"th",44),n()(),a(5,"tbody"),b(6,J,2,1,"tr",44),n()()()),i&2){let e=d(2);o(4),c("ngForOf",e.tableData.columns),o(2),c("ngForOf",e.filteredRecords)}}function Y(i,t){if(i&1&&(a(0,"div",46)(1,"p"),r(2),n()()),i&2){let e=d(2);o(2),u('No records match "',e.searchTerm,'"')}}function K(i,t){i&1&&(a(0,"div",46)(1,"p"),r(2,"This table is empty"),n()())}function G(i,t){if(i&1){let e=C();a(0,"div",31)(1,"div",32)(2,"div",33)(3,"button",34),x("click",function(){h(e);let s=d();return f(s.backToDiagram())}),r(4,"\u2190 Back to Schema"),n(),a(5,"h2"),r(6),n()(),a(7,"div",35)(8,"div",36)(9,"input",37),T("ngModelChange",function(s){h(e);let v=d();return O(v.searchTerm,s)||(v.searchTerm=s),f(s)}),n()(),a(10,"button",38),x("click",function(){h(e);let s=d();return f(s.exportTable())}),r(11," \u{1F4E5} Export JSON "),n()()(),a(12,"div",39)(13,"span"),r(14),n(),a(15,"span"),r(16),n()(),b(17,W,7,2,"div",40)(18,Y,3,1,"div",41)(19,K,3,0,"div",41),n()}if(i&2){let e=d();o(6),y("",e.selectedTable==null?null:e.selectedTable.icon," ",e.selectedTable==null?null:e.selectedTable.displayName),o(3),w("ngModel",e.searchTerm),o(5),y("",e.filteredRecords.length," of ",e.tableData.records.length," records"),o(2),u("Key: ",e.selectedTable==null?null:e.selectedTable.keyPath),o(),c("ngIf",e.filteredRecords.length>0),o(),c("ngIf",e.filteredRecords.length===0&&e.searchTerm),o(),c("ngIf",e.tableData.records.length===0&&!e.searchTerm)}}var j=class i{constructor(t,e){this.dbService=t;this.router=e}tables=[];selectedTable=null;tableData=null;isLoading=!1;searchTerm="";viewMode="diagram";get totalRecords(){return this.tables.reduce((t,e)=>t+e.recordCount,0)}get totalIndices(){return this.tables.reduce((t,e)=>t+e.indices.length,0)}ngOnInit(){return p(this,null,function*(){yield this.loadTableInfo()})}loadTableInfo(){return p(this,null,function*(){this.isLoading=!0;try{this.tables=[{name:"userFile",displayName:"User Configuration",icon:"\u{1F4DA}",recordCount:0,keyPath:"id",indices:[],description:"User file and dataset configuration (single record)",relatedTables:["questionDetail"]},{name:"questionDetail",displayName:"Questions",icon:"\u2753",recordCount:0,keyPath:"questionID",indices:["qDescType","book","version"],description:"Quiz questions with chapter and verse references",relatedTables:["userFile","quizSet"]},{name:"players",displayName:"Players",icon:"\u{1F464}",recordCount:0,keyPath:"playerNumber",indices:["name","team"],description:"Player information and team assignments",relatedTables:["teams","matchStats"]},{name:"teams",displayName:"Team Rosters",icon:"\u{1F465}",recordCount:0,keyPath:"teamName,playerNumber",indices:["teamName"],description:"Team member relationships (one record per player-team pair)",relatedTables:["players","matchSummary"]},{name:"quizSet",displayName:"Quiz Sets",icon:"\u{1F4CB}",recordCount:0,keyPath:"setID,questNum",indices:["setID"],description:"Question assignments to quiz sets",relatedTables:["questionDetail"]},{name:"matchSummary",displayName:"Match Summaries",icon:"\u{1F4CA}",recordCount:0,keyPath:"quizID,matchID",indices:[],description:"Match score summaries and team matchups",relatedTables:["matchDetail","teams","tournaments"]},{name:"matchDetail",displayName:"Match Event Details",icon:"\u{1F3C6}",recordCount:0,keyPath:"quizID,matchID,seqNum",indices:[],description:"Detailed match event history (question-by-question)",relatedTables:["matchSummary","tournaments"]},{name:"matchStats",displayName:"Player Match Statistics",icon:"\u{1F4C8}",recordCount:0,keyPath:"playerNumber,quizID,matchID",indices:[],description:"Individual player statistics per match",relatedTables:["players","matchDetail"]},{name:"tournaments",displayName:"Tournaments",icon:"\u{1F3C5}",recordCount:0,keyPath:"tournamentID",indices:["status","createdAt"],description:"Tournament definitions and brackets",relatedTables:["matchSummary","matchDetail"]},{name:"verses",displayName:"Bible Verses",icon:"\u{1F4D6}",recordCount:0,keyPath:"chapter,verse",indices:[],description:"Bible verse text by chapter and verse",relatedTables:["questionDetail"]},{name:"types",displayName:"Question Types",icon:"\u{1F524}",recordCount:0,keyPath:"typeID",indices:[],description:"Question type definitions (IC, MC, FC, IV, MV, Q)",relatedTables:["questionDetail"]},{name:"parms",displayName:"Match Parameters",icon:"\u2699\uFE0F",recordCount:0,keyPath:"book",indices:[],description:"Match settings and scoring parameters",relatedTables:[]},{name:"questionSelect",displayName:"Question Selection Stats",icon:"\u{1F4CA}",recordCount:0,keyPath:"selectionID",indices:[],description:"Question usage statistics and selection tracking",relatedTables:["questionDetail"]}];for(let t of this.tables)try{let e=yield this.getTableCount(t.name);t.recordCount=e}catch(e){console.warn(`Could not get count for ${t.name}:`,e),t.recordCount=0}}catch(t){console.error("Error loading table info:",t),alert("Error loading database information. Check console for details.")}finally{this.isLoading=!1}})}getTableCount(t){return p(this,null,function*(){let e=yield this.dbService.getDatabase();return new Promise((l,s)=>{let m=e.transaction([t],"readonly").objectStore(t).count();m.onsuccess=()=>l(m.result),m.onerror=()=>s(m.error)})})}selectTable(t){return p(this,null,function*(){this.selectedTable=t,this.viewMode="table",this.isLoading=!0;try{let e=yield this.getTableRecords(t.name),l=e.length>0?Object.keys(e[0]):[];this.tableData={tableName:t.name,records:e,columns:l}}catch(e){console.error(`Error loading data for ${t.name}:`,e),alert("Error loading table data. Check console for details.")}finally{this.isLoading=!1}})}getTableRecords(t){return p(this,null,function*(){let e=yield this.dbService.getDatabase();return new Promise((l,s)=>{let m=e.transaction([t],"readonly").objectStore(t).getAll();m.onsuccess=()=>l(m.result),m.onerror=()=>s(m.error)})})}get filteredRecords(){if(!this.tableData||!this.searchTerm)return this.tableData?.records||[];let t=this.searchTerm.toLowerCase();return this.tableData.records.filter(e=>Object.values(e).some(l=>l==null?!1:String(l).toLowerCase().includes(t)))}formatValue(t){return t==null?"-":typeof t=="object"?JSON.stringify(t):typeof t=="boolean"?t?"\u2713":"\u2717":String(t)}backToDiagram(){this.viewMode="diagram",this.selectedTable=null,this.tableData=null,this.searchTerm=""}onReturn(){this.router.navigate(["/"])}exportTable(){return p(this,null,function*(){if(!this.tableData)return;let t=JSON.stringify(this.tableData.records,null,2),e=new Blob([t],{type:"application/json"}),l=URL.createObjectURL(e),s=document.createElement("a");s.href=l,s.download=`${this.tableData.tableName}_export.json`,s.click(),URL.revokeObjectURL(l)})}refreshData(){return p(this,null,function*(){this.selectedTable?yield this.selectTable(this.selectedTable):yield this.loadTableInfo()})}static \u0275fac=function(e){return new(e||i)(_(q),_(E))};static \u0275cmp=P({type:i,selectors:[["app-database-explorer"]],decls:13,vars:4,consts:[[1,"explorer-container"],[1,"explorer-header"],[1,"header-actions"],[1,"btn","btn-secondary",3,"click","disabled"],[1,"btn","btn-secondary",3,"click"],[1,"explorer-content"],["class","loading-state",4,"ngIf"],["class","diagram-view",4,"ngIf"],["class","table-view",4,"ngIf"],[1,"loading-state"],[1,"diagram-view"],[1,"diagram-header"],[1,"help-text"],[1,"tables-grid"],["class","table-card",3,"empty","click",4,"ngFor","ngForOf"],[1,"schema-info"],[1,"stats-grid"],[1,"stat-card"],[1,"stat-value"],[1,"stat-label"],[1,"table-card",3,"click"],[1,"table-card-icon"],[1,"table-card-content"],[1,"table-description"],[1,"table-stats"],[1,"record-count"],[1,"key-path"],["class","table-indices",4,"ngIf"],["class","table-relations",4,"ngIf"],[1,"table-indices"],[1,"table-relations"],[1,"table-view"],[1,"table-view-header"],[1,"table-view-title"],[1,"btn-back",3,"click"],[1,"table-view-actions"],[1,"search-box"],["type","text","placeholder","Search in table...",1,"search-input",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"click"],[1,"table-info-bar"],["class","data-table-container",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"data-table-container"],[1,"data-table"],[4,"ngFor","ngForOf"],[1,"cell-value"],[1,"empty-state"]],template:function(e,l){e&1&&(a(0,"div",0)(1,"div",1)(2,"h1"),r(3,"Database Explorer"),n(),a(4,"div",2)(5,"button",3),x("click",function(){return l.refreshData()}),r(6," \u{1F504} Refresh "),n(),a(7,"button",4),x("click",function(){return l.onReturn()}),r(8,"Return"),n()()(),a(9,"div",5),b(10,V,3,0,"div",6)(11,B,27,4,"div",7)(12,G,20,9,"div",8),n()()),e&2&&(o(5),c("disabled",l.isLoading),o(5),c("ngIf",l.isLoading),o(),c("ngIf",l.viewMode==="diagram"&&!l.isLoading),o(),c("ngIf",l.viewMode==="table"&&!l.isLoading&&l.tableData))},dependencies:[S,D,k,R,I,N,z],styles:[".explorer-container[_ngcontent-%COMP%]{min-height:100vh;padding:var(--spacing-xl);background:linear-gradient(135deg,#f5f7fa,#c3cfe2)}.explorer-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--spacing-2xl);padding-bottom:var(--spacing-lg);border-bottom:3px solid var(--xl-blue)}.explorer-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-family:var(--font-heading);font-size:2.5rem;color:var(--xl-blue-dark);margin:0;font-weight:700}.header-actions[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-md)}.explorer-content[_ngcontent-%COMP%]{max-width:1800px;margin:0 auto}.diagram-view[_ngcontent-%COMP%]{background:var(--xl-white);border-radius:var(--radius-lg);padding:var(--spacing-xl);box-shadow:var(--shadow-xl)}.diagram-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:var(--spacing-2xl)}.diagram-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2rem;color:var(--xl-blue-dark);margin-bottom:var(--spacing-sm)}.tables-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:var(--spacing-lg);margin-bottom:var(--spacing-2xl)}.table-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fff,#f8f9fa);border:2px solid var(--xl-gray-light);border-radius:var(--radius-lg);padding:var(--spacing-lg);cursor:pointer;transition:all var(--transition-base);position:relative;overflow:hidden}.table-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:var(--shadow-xl);border-color:var(--xl-blue)}.table-card.empty[_ngcontent-%COMP%]{opacity:.6;border-style:dashed}.table-card-icon[_ngcontent-%COMP%]{font-size:3rem;text-align:center;margin-bottom:var(--spacing-md)}.table-card-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--xl-blue-dark);margin:0 0 var(--spacing-sm) 0;font-weight:700}.table-description[_ngcontent-%COMP%]{color:#2c3e50;font-size:.9375rem;margin-bottom:var(--spacing-md);font-weight:500}.table-stats[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-sm) 0;border-top:1px solid var(--xl-gray-light);border-bottom:1px solid var(--xl-gray-light);margin-bottom:var(--spacing-sm)}.record-count[_ngcontent-%COMP%]{font-weight:700;color:var(--xl-blue);font-size:.9375rem}.key-path[_ngcontent-%COMP%]{font-size:.8125rem;color:#34495e;font-family:monospace;font-weight:600}.table-indices[_ngcontent-%COMP%], .table-relations[_ngcontent-%COMP%]{font-size:.8125rem;color:#2c3e50;margin-top:var(--spacing-xs);font-weight:500}.table-indices[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .table-relations[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--xl-blue-dark);font-weight:700}.schema-info[_ngcontent-%COMP%]{background:#3b82f61a;border-radius:var(--radius-lg);padding:var(--spacing-xl);border-left:4px solid var(--xl-blue)}.schema-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--xl-blue-dark);margin:0 0 var(--spacing-lg) 0}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:var(--spacing-lg)}.stat-card[_ngcontent-%COMP%]{background:var(--xl-white);border-radius:var(--radius-md);padding:var(--spacing-lg);text-align:center}.stat-value[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:var(--xl-blue);line-height:1;margin-bottom:var(--spacing-sm)}.stat-label[_ngcontent-%COMP%]{font-size:.875rem;color:#34495e;text-transform:uppercase;letter-spacing:.5px;font-weight:600}.table-view[_ngcontent-%COMP%]{background:var(--xl-white);border-radius:var(--radius-lg);padding:var(--spacing-xl);box-shadow:var(--shadow-xl)}.table-view-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--spacing-lg);flex-wrap:wrap;gap:var(--spacing-md)}.table-view-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-md)}.table-view-title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2rem;color:var(--xl-blue-dark);margin:0}.btn-back[_ngcontent-%COMP%]{background:none;border:2px solid var(--xl-blue);color:var(--xl-blue);padding:.5rem 1rem;border-radius:var(--radius-md);cursor:pointer;font-weight:600;transition:all var(--transition-base)}.btn-back[_ngcontent-%COMP%]:hover{background:var(--xl-blue);color:var(--xl-white);transform:translate(-4px)}.table-view-actions[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-md);align-items:center}.search-box[_ngcontent-%COMP%]{position:relative}.search-input[_ngcontent-%COMP%]{padding:.75rem 1rem;border:2px solid var(--xl-gray-light);border-radius:var(--radius-md);font-size:1rem;min-width:300px;transition:border-color var(--transition-base)}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--xl-blue)}.table-info-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background:#3b82f61a;border-radius:var(--radius-md);margin-bottom:var(--spacing-lg);font-size:.875rem;color:var(--xl-blue-dark)}.data-table-container[_ngcontent-%COMP%]{overflow-x:auto;border:1px solid var(--xl-gray-light);border-radius:var(--radius-md)}.data-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.875rem}.data-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:var(--xl-blue-dark);color:var(--xl-white);position:sticky;top:0;z-index:10}.data-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:var(--spacing-md);text-align:left;font-weight:600;white-space:nowrap;border-bottom:2px solid var(--xl-blue)}.data-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid var(--xl-gray-light);transition:background var(--transition-base)}.data-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#3b82f60d}.data-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background:#00000005}.data-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n):hover{background:#3b82f614}.data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:var(--spacing-md);vertical-align:top;max-width:400px}.cell-value[_ngcontent-%COMP%]{display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:hover   .cell-value[_ngcontent-%COMP%]{white-space:normal;word-break:break-word}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:var(--spacing-2xl);background:var(--xl-white);border-radius:var(--radius-lg);box-shadow:var(--shadow-md)}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.25rem;color:var(--xl-gray);margin:0}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:var(--spacing-2xl);background:#fbbf241a;border-radius:var(--radius-lg);border:2px dashed var(--xl-gray-light)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.125rem;color:#34495e;margin:0;font-weight:600}.help-text[_ngcontent-%COMP%]{font-size:.9375rem;color:#2c3e50;margin:0;font-weight:500}.btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;font-size:1rem;font-weight:600;border-radius:var(--radius-md);cursor:pointer;transition:all var(--transition-base);border:none;font-family:var(--font-primary)}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--xl-blue) 0%,var(--xl-blue-dark) 100%);color:var(--xl-white);box-shadow:var(--shadow-md)}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:var(--shadow-lg)}.btn-secondary[_ngcontent-%COMP%]{background:var(--xl-gray-light);color:var(--xl-black)}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--xl-gray);transform:translateY(-2px)}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}@media (max-width: 768px){.explorer-header[_ngcontent-%COMP%]{flex-direction:column;gap:var(--spacing-md);align-items:flex-start}.tables-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.table-view-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.table-view-actions[_ngcontent-%COMP%]{flex-direction:column}.search-input[_ngcontent-%COMP%]{min-width:100%}.data-table-container[_ngcontent-%COMP%]{overflow-x:scroll}.stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};export{j as DatabaseExplorerComponent};
