import{a as at}from"./chunk-QUMNU2Z6.js";import{a as nt}from"./chunk-7WO65EVB.js";import{a as it}from"./chunk-KODUIQMG.js";import{p as et}from"./chunk-GJ3ACHC3.js";import{$,Da as Y,Ea as A,Fa as Q,H as s,Ha as D,I as N,M as z,N as k,Na as tt,R as v,W as d,X as o,Y as r,_ as R,a as V,aa as I,ba as _,ca as m,d as C,da as Z,ea as j,fa as x,ha as c,ia as O,ja as P,ka as E,qa as G,sa as K,va as X,y,z as w}from"./chunk-45QSGMLT.js";function st(a,e){if(a&1){let t=I();o(0,"div",7)(1,"button",8),_("click",function(){y(t);let n=m();return w(n.setMode("substitute"))}),c(2," Substitute Player "),r(),o(3,"button",8),_("click",function(){y(t);let n=m();return w(n.setMode("swap"))}),c(4," Swap Chairs "),r()()}if(a&2){let t=m();s(),x("active",t.mode==="substitute"),s(2),x("active",t.mode==="swap")}}function ot(a,e){if(a&1&&(o(0,"span",19),c(1),r()),a&2){let t=m().$implicit;s(),O(t.status)}}function lt(a,e){if(a&1){let t=I();o(0,"button",15),_("click",function(){let n=y(t).$implicit,l=m(3);return w(l.selectChair(n.index))}),o(1,"span",16),c(2),r(),o(3,"span",17),c(4),r(),v(5,ot,2,1,"span",18),r()}if(a&2){let t=e.$implicit,i=m(3);x("selected",i.selectedChairIndex===t.index)("disabled",t.isEmpty),d("disabled",t.isEmpty),s(2),P("Chair ",t.index+1),s(2),O(t.displayName),s(),d("ngIf",t.status)}}function ct(a,e){if(a&1&&(o(0,"div",10)(1,"h3"),c(2,"Select Chair to Replace:"),r(),o(3,"div",13),v(4,lt,6,8,"button",14),r()()),a&2){let t=m(2);s(4),d("ngForOf",t.chairs)}}function ut(a,e){if(a&1&&(o(0,"div",10)(1,"div",20)(2,"p")(3,"strong"),c(4),r(),c(5),r(),o(6,"p"),c(7,"Select a substitute:"),r()()()),a&2){let t=m(2);s(4),O(t.chairs[t.autoSubChairIndex]==null?null:t.chairs[t.autoSubChairIndex].displayName),s(),P(" has ",t.autoSubReason,".")}}function mt(a,e){if(a&1&&(o(0,"span",26),c(1),r()),a&2){let t=m().$implicit;x("quiz-out",t.status==="Quizzed Out")("error-out",t.status==="Errored Out")("foul-out",t.status==="Fouled Out"),s(),O(t.status)}}function dt(a,e){if(a&1){let t=I();o(0,"button",23),_("click",function(){let n=y(t).$implicit,l=m(3);return w(l.selectPlayer(n.playerNumber))}),o(1,"span",24),c(2),r(),v(3,mt,2,7,"span",25),r()}if(a&2){let t=e.$implicit,i=m(3);x("selected",i.selectedPlayerNumber===t.playerNumber)("has-status",t.status),s(2),O(t.displayName),s(),d("ngIf",t.status)}}function ht(a,e){if(a&1&&(o(0,"div",21),v(1,dt,4,6,"button",22),r()),a&2){let t=m(2);s(),d("ngForOf",t.availableSubs)}}function pt(a,e){a&1&&(o(0,"p",27),c(1," No available substitutes on the bench. "),r())}function gt(a,e){if(a&1&&(R(0),v(1,ct,5,1,"div",9)(2,ut,8,2,"div",9),o(3,"div",10)(4,"h3"),c(5,"Available Substitutes:"),r(),v(6,ht,2,1,"div",11)(7,pt,2,0,"p",12),r(),$()),a&2){let t=m();s(),d("ngIf",t.autoSubChairIndex===null),s(),d("ngIf",t.autoSubChairIndex!==null),s(4),d("ngIf",t.availableSubs.length>0),s(),d("ngIf",t.availableSubs.length===0)}}function ft(a,e){if(a&1&&(o(0,"span",33),c(1),r()),a&2){let t=m().$implicit,i=m(2);s(),P(" ",i.getSwapSelectionNumber(t.index)," ")}}function bt(a,e){if(a&1&&(o(0,"span",19),c(1),r()),a&2){let t=m().$implicit;s(),O(t.status)}}function _t(a,e){if(a&1){let t=I();o(0,"button",15),_("click",function(){let n=y(t).$implicit,l=m(2);return w(l.selectChairForSwap(n.index))}),v(1,ft,2,1,"span",32),o(2,"span",16),c(3),r(),o(4,"span",17),c(5),r(),v(6,bt,2,1,"span",18),r()}if(a&2){let t=e.$implicit,i=m(2);x("swap-selected",i.isSwapSelected(t.index))("swap-first",i.swapChair1===t.index)("swap-second",i.swapChair2===t.index)("disabled",t.isEmpty),d("disabled",t.isEmpty),s(),d("ngIf",i.getSwapSelectionNumber(t.index)),s(2),P("Chair ",t.index+1),s(2),O(t.displayName),s(),d("ngIf",t.status)}}function vt(a,e){if(a&1&&(o(0,"div",34)(1,"p")(2,"strong"),c(3),r(),c(4),r(),o(5,"p")(6,"strong"),c(7),r(),c(8),r()()),a&2){let t=m(2);s(3),O(t.chairs[t.swapChair1]==null?null:t.chairs[t.swapChair1].displayName),s(),P(" will move to Chair ",t.swapChair2+1," "),s(3),O(t.chairs[t.swapChair2]==null?null:t.chairs[t.swapChair2].displayName),s(),P(" will move to Chair ",t.swapChair1+1," ")}}function xt(a,e){if(a&1&&(R(0),o(1,"div",10)(2,"h3"),c(3,"Select Two Chairs to Swap:"),r(),o(4,"p",28),c(5,"Click on two chairs to swap their players."),r(),o(6,"div",29),v(7,_t,7,13,"button",30),r()(),v(8,vt,9,4,"div",31),$()),a&2){let t=m();s(7),d("ngForOf",t.chairs),s(),d("ngIf",t.swapChair1!==null&&t.swapChair2!==null)}}var F=class a{teamName="";chairs=[];availableSubs=[];autoSubChairIndex=null;autoSubReason="";confirmed=new N;swapConfirmed=new N;cancelled=new N;mode="substitute";selectedChairIndex=null;selectedPlayerNumber=null;swapChair1=null;swapChair2=null;ngOnInit(){console.log("SubstitutionDialog initialized:",{chairs:this.chairs,occupiedCount:this.getOccupiedChairsCount(),canSwap:this.canSwap(),autoSubChairIndex:this.autoSubChairIndex}),this.autoSubChairIndex!==null&&(this.selectedChairIndex=this.autoSubChairIndex)}setMode(e){this.mode=e,this.selectedChairIndex=null,this.selectedPlayerNumber=null,this.swapChair1=null,this.swapChair2=null}selectChair(e){this.mode==="substitute"?this.autoSubChairIndex===null&&(this.selectedChairIndex=e):this.mode==="swap"&&this.selectChairForSwap(e)}selectChairForSwap(e){this.chairs[e].isEmpty||(this.swapChair1===null?this.swapChair1=e:this.swapChair1===e?this.swapChair1=null:this.swapChair2===null?this.swapChair2=e:this.swapChair2===e?this.swapChair2=null:(this.swapChair1=e,this.swapChair2=null))}isSwapSelected(e){return this.swapChair1===e||this.swapChair2===e}getSwapSelectionNumber(e){return this.swapChair1===e?1:this.swapChair2===e?2:null}selectPlayer(e){this.selectedPlayerNumber=e}canConfirm(){return this.mode==="substitute"?this.selectedChairIndex!==null&&this.selectedPlayerNumber!==null:this.swapChair1!==null&&this.swapChair2!==null}confirm(){this.mode==="substitute"&&this.canConfirm()?this.confirmed.emit({chairIndex:this.selectedChairIndex,playerNumber:this.selectedPlayerNumber}):this.mode==="swap"&&this.canConfirm()&&this.swapConfirmed.emit({chairIndex1:this.swapChair1,chairIndex2:this.swapChair2})}cancel(){this.cancelled.emit()}getOccupiedChairsCount(){return this.chairs.filter(e=>!e.isEmpty).length}canSwap(){return this.getOccupiedChairsCount()>=2}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=k({type:a,selectors:[["app-substitution-dialog"]],inputs:{teamName:"teamName",chairs:"chairs",availableSubs:"availableSubs",autoSubChairIndex:"autoSubChairIndex",autoSubReason:"autoSubReason"},outputs:{confirmed:"confirmed",swapConfirmed:"swapConfirmed",cancelled:"cancelled"},decls:12,vars:6,consts:[[1,"dialog-overlay",3,"click"],[1,"dialog-content",3,"click"],["class","mode-toggle",4,"ngIf"],[4,"ngIf"],[1,"dialog-actions"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click","disabled"],[1,"mode-toggle"],[1,"mode-btn",3,"click"],["class","dialog-section",4,"ngIf"],[1,"dialog-section"],["class","sub-list",4,"ngIf"],["class","no-subs-message",4,"ngIf"],[1,"chair-list"],["class","chair-button",3,"selected","disabled","click",4,"ngFor","ngForOf"],[1,"chair-button",3,"click","disabled"],[1,"chair-label"],[1,"chair-name"],["class","chair-status",4,"ngIf"],[1,"chair-status"],[1,"auto-sub-info"],[1,"sub-list"],["class","sub-button",3,"selected","has-status","click",4,"ngFor","ngForOf"],[1,"sub-button",3,"click"],[1,"sub-name"],["class","sub-status",3,"quiz-out","error-out","foul-out",4,"ngIf"],[1,"sub-status"],[1,"no-subs-message"],[1,"swap-instructions"],[1,"chair-list","swap-mode"],["class","chair-button",3,"swap-selected","swap-first","swap-second","disabled","click",4,"ngFor","ngForOf"],["class","swap-preview",4,"ngIf"],["class","swap-number",4,"ngIf"],[1,"swap-number"],[1,"swap-preview"]],template:function(t,i){t&1&&(o(0,"div",0),_("click",function(){return i.cancel()}),o(1,"div",1),_("click",function(l){return l.stopPropagation()}),o(2,"h2"),c(3),r(),v(4,st,5,4,"div",2)(5,gt,8,4,"ng-container",3)(6,xt,9,2,"ng-container",3),o(7,"div",4)(8,"button",5),_("click",function(){return i.cancel()}),c(9,"Cancel"),r(),o(10,"button",6),_("click",function(){return i.confirm()}),c(11),r()()()()),t&2&&(s(3),P("",i.teamName," Substitution"),s(),d("ngIf",i.autoSubChairIndex===null&&i.canSwap()),s(),d("ngIf",i.mode==="substitute"),s(),d("ngIf",i.mode==="swap"),s(4),d("disabled",!i.canConfirm()),s(),P(" ",i.mode==="substitute"?"Confirm Substitution":"Confirm Swap"," "))},dependencies:[D,A,Q],styles:[".dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0009;display:flex;align-items:center;justify-content:center;z-index:1000;padding:var(--spacing-md)}.dialog-content[_ngcontent-%COMP%]{background:var(--xl-white);border-radius:var(--radius-lg);box-shadow:var(--shadow-xl);padding:var(--spacing-md);max-width:550px;width:100%;max-height:90vh;overflow-y:auto;display:flex;flex-direction:column;gap:var(--spacing-sm)}.dialog-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.3rem;font-weight:700;color:var(--xl-blue-dark);font-family:var(--font-heading)}.dialog-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1rem;font-weight:600;color:var(--xl-gray-dark)}.dialog-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-xs)}.auto-sub-info[_ngcontent-%COMP%]{background:var(--xl-blue-lighter);border-radius:var(--radius-md);padding:var(--spacing-sm);border:1px solid var(--xl-blue)}.auto-sub-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 var(--spacing-xs) 0;color:var(--xl-gray-dark);font-size:.9rem}.auto-sub-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:last-child{margin-bottom:0}.chair-list[_ngcontent-%COMP%], .sub-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:var(--spacing-xs)}.chair-button[_ngcontent-%COMP%], .sub-button[_ngcontent-%COMP%]{padding:var(--spacing-xs) var(--spacing-sm);border:2px solid var(--xl-gray);border-radius:var(--radius-md);background:var(--xl-white);cursor:pointer;transition:all var(--transition-base);text-align:left;font-size:.9rem;font-weight:600;color:var(--xl-gray-dark);display:flex;flex-direction:column;gap:.15rem}.sub-button[_ngcontent-%COMP%]{flex-direction:row;align-items:center;justify-content:space-between;gap:var(--spacing-xs)}.sub-button.has-status[_ngcontent-%COMP%]{flex-wrap:wrap}.sub-name[_ngcontent-%COMP%]{flex:1;min-width:0}.sub-status[_ngcontent-%COMP%]{font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.03em;padding:.25rem .5rem;border-radius:var(--radius-sm);white-space:nowrap}.sub-status.quiz-out[_ngcontent-%COMP%]{background:#28a745;color:#fff}.sub-status.error-out[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.sub-status.foul-out[_ngcontent-%COMP%]{background:#b8860b;color:#fff}.sub-button.selected[_ngcontent-%COMP%]   .sub-status[_ngcontent-%COMP%]{background:#fff}.sub-button.selected[_ngcontent-%COMP%]   .sub-status.quiz-out[_ngcontent-%COMP%]{color:#28a745}.sub-button.selected[_ngcontent-%COMP%]   .sub-status.error-out[_ngcontent-%COMP%]{color:#dc3545}.sub-button.selected[_ngcontent-%COMP%]   .sub-status.foul-out[_ngcontent-%COMP%]{color:#b8860b}.chair-button[_ngcontent-%COMP%]:hover:not(:disabled), .sub-button[_ngcontent-%COMP%]:hover{background:var(--xl-blue-lighter);border-color:var(--xl-blue)}.chair-button.selected[_ngcontent-%COMP%], .sub-button.selected[_ngcontent-%COMP%]{background:var(--xl-blue);border-color:var(--xl-blue-dark);color:var(--xl-white)}.chair-button.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed;background:var(--xl-gray-light)}.chair-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.05em;opacity:.7}.chair-name[_ngcontent-%COMP%]{font-size:.9rem}.chair-status[_ngcontent-%COMP%]{font-size:.75rem;font-weight:700;color:var(--xl-gold-dark);text-transform:uppercase}.chair-button.selected[_ngcontent-%COMP%]   .chair-status[_ngcontent-%COMP%]{color:var(--xl-white)}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm);justify-content:flex-end;padding-top:var(--spacing-sm);border-top:1px solid var(--xl-gray-light)}.dialog-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:var(--spacing-xs) var(--spacing-md);font-size:.9rem}.btn-primary[_ngcontent-%COMP%]{background:var(--xl-blue);color:var(--xl-white);border:2px solid var(--xl-blue-dark)}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--xl-blue-dark)}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.mode-toggle[_ngcontent-%COMP%]{display:flex;gap:0;background:var(--xl-gray-light);border-radius:var(--radius-md);padding:3px;margin-bottom:var(--spacing-xs)}.mode-btn[_ngcontent-%COMP%]{flex:1;padding:var(--spacing-xs) var(--spacing-sm);border:none;background:transparent;border-radius:calc(var(--radius-md) - 2px);font-size:.85rem;font-weight:600;color:var(--xl-gray-dark);cursor:pointer;transition:all var(--transition-base)}.mode-btn[_ngcontent-%COMP%]:hover{background:#ffffff80}.mode-btn.active[_ngcontent-%COMP%]{background:var(--xl-white);color:var(--xl-blue-dark);box-shadow:var(--shadow-sm)}.swap-instructions[_ngcontent-%COMP%]{font-size:.85rem;color:var(--xl-gray-medium);margin:0}.chair-list.swap-mode[_ngcontent-%COMP%]   .chair-button[_ngcontent-%COMP%]{position:relative}.chair-button.swap-selected[_ngcontent-%COMP%]{background:var(--xl-blue-lighter);border-color:var(--xl-blue)}.chair-button.swap-first[_ngcontent-%COMP%]{border-color:var(--xl-blue-dark);background:var(--xl-blue);color:var(--xl-white)}.chair-button.swap-second[_ngcontent-%COMP%]{border-color:#22c55e;background:#22c55e;color:var(--xl-white)}.swap-number[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;width:22px;height:22px;border-radius:50%;background:var(--xl-blue-dark);color:var(--xl-white);font-size:.75rem;font-weight:700;display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow-md)}.chair-button.swap-second[_ngcontent-%COMP%]   .swap-number[_ngcontent-%COMP%]{background:#16a34a}.swap-preview[_ngcontent-%COMP%]{background:linear-gradient(135deg,var(--xl-blue-lighter) 0%,#dcfce7 100%);border-radius:var(--radius-md);padding:var(--spacing-sm);border:1px solid var(--xl-blue);text-align:center}.swap-preview[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.9rem;color:var(--xl-gray-dark)}.swap-preview[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] + p[_ngcontent-%COMP%]{margin-top:var(--spacing-xs)}.no-subs-message[_ngcontent-%COMP%]{font-size:.9rem;color:var(--xl-gray-medium);font-style:italic;text-align:center;padding:var(--spacing-sm)}@media (max-width: 768px){.dialog-content[_ngcontent-%COMP%]{max-width:100%;margin:var(--spacing-sm)}.chair-list[_ngcontent-%COMP%], .sub-list[_ngcontent-%COMP%]{grid-template-columns:1fr}.dialog-actions[_ngcontent-%COMP%]{flex-direction:column}.dialog-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}.mode-toggle[_ngcontent-%COMP%]{flex-direction:column}}"]})};function St(a,e){a&1&&(o(0,"div",8),c(1,"Time Remaining"),r())}function Ct(a,e){a&1&&(o(0,"div",9),c(1,"Time Expired"),r())}var B=class a{teamName="";durationSeconds=60;completed=new N;timeRemaining=0;timerInterval=null;ngOnInit(){this.timeRemaining=this.durationSeconds,this.startTimer()}ngOnDestroy(){this.stopTimer()}startTimer(){this.timerInterval=setInterval(()=>{this.timeRemaining--,this.timeRemaining<=0&&(this.stopTimer(),this.completed.emit())},1e3)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}getTimerDisplay(){let e=Math.floor(this.timeRemaining/60),t=this.timeRemaining%60;return`${e}:${t.toString().padStart(2,"0")}`}endTimeout(){this.stopTimer(),this.completed.emit()}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=k({type:a,selectors:[["app-timeout-dialog"]],inputs:{teamName:"teamName",durationSeconds:"durationSeconds"},outputs:{completed:"completed"},decls:12,vars:9,consts:[[1,"dialog-overlay"],[1,"dialog-content"],[1,"timer-display"],[1,"timer-value"],["class","timer-label",4,"ngIf"],["class","timer-label expired-label",4,"ngIf"],[1,"dialog-actions"],[1,"btn","btn-primary",3,"click"],[1,"timer-label"],[1,"timer-label","expired-label"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"div",1)(2,"h2"),c(3),r(),o(4,"div",2)(5,"div",3),c(6),r(),v(7,St,2,0,"div",4)(8,Ct,2,0,"div",5),r(),o(9,"div",6)(10,"button",7),_("click",function(){return i.endTimeout()}),c(11),r()()()()),t&2&&(s(3),P("",i.teamName," Timeout"),s(),x("warning",i.timeRemaining<=10&&i.timeRemaining>0)("expired",i.timeRemaining===0),s(2),O(i.getTimerDisplay()),s(),d("ngIf",i.timeRemaining>0),s(),d("ngIf",i.timeRemaining===0),s(3),P(" ",i.timeRemaining===0?"Close":"End Timeout Early"," "))},dependencies:[D,Q],styles:[".dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0009;display:flex;align-items:center;justify-content:center;z-index:1000;padding:var(--spacing-md)}.dialog-content[_ngcontent-%COMP%]{background:var(--xl-white);border-radius:var(--radius-lg);box-shadow:var(--shadow-xl);padding:var(--spacing-lg);max-width:400px;width:100%;display:flex;flex-direction:column;gap:var(--spacing-lg);text-align:center}.dialog-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:700;color:var(--xl-blue-dark);font-family:var(--font-heading)}.timer-display[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-xl);background:var(--xl-gray-lighter);border-radius:var(--radius-lg);border:3px solid var(--xl-blue);transition:all var(--transition-base)}.timer-display.warning[_ngcontent-%COMP%]{border-color:var(--xl-gold);background:var(--xl-gold-lighter);animation:_ngcontent-%COMP%_pulse-warning 1s infinite}.timer-display.expired[_ngcontent-%COMP%]{border-color:var(--xl-red);background:var(--xl-red-lighter)}.timer-value[_ngcontent-%COMP%]{font-size:4rem;font-weight:700;color:var(--xl-blue-dark);font-family:Courier New,monospace;line-height:1}.timer-display.warning[_ngcontent-%COMP%]   .timer-value[_ngcontent-%COMP%]{color:var(--xl-gold-dark)}.timer-display.expired[_ngcontent-%COMP%]   .timer-value[_ngcontent-%COMP%]{color:var(--xl-red-dark)}.timer-label[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:var(--xl-gray-dark);text-transform:uppercase;letter-spacing:.05em}.expired-label[_ngcontent-%COMP%]{color:var(--xl-red-dark)}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm);justify-content:center}.dialog-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:var(--spacing-sm) var(--spacing-lg);font-size:1rem;min-width:180px}.btn-primary[_ngcontent-%COMP%]{background:var(--xl-blue);color:var(--xl-white);border:2px solid var(--xl-blue-dark);border-radius:var(--radius-md);cursor:pointer;font-weight:600;transition:all var(--transition-base)}.btn-primary[_ngcontent-%COMP%]:hover{background:var(--xl-blue-dark)}@keyframes _ngcontent-%COMP%_pulse-warning{0%{box-shadow:0 0 #f59e0bb3}50%{box-shadow:0 0 0 10px #f59e0b00}to{box-shadow:0 0 #f59e0b00}}@media (max-width: 768px){.dialog-content[_ngcontent-%COMP%]{max-width:100%;margin:var(--spacing-sm)}.timer-value[_ngcontent-%COMP%]{font-size:3rem}.dialog-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}"]})};function yt(a,e){a&1&&(o(0,"div",9),c(1,"Time Remaining"),r())}function wt(a,e){a&1&&(o(0,"div",10),c(1,"Time Expired"),r())}var L=class a{teamName="";durationSeconds=90;completed=new N;timeRemaining=0;timerInterval=null;ngOnInit(){this.timeRemaining=this.durationSeconds,this.startTimer()}ngOnDestroy(){this.stopTimer()}startTimer(){this.timerInterval=setInterval(()=>{this.timeRemaining--,this.timeRemaining<=0&&(this.stopTimer(),this.completed.emit())},1e3)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}getTimerDisplay(){let e=Math.floor(this.timeRemaining/60),t=this.timeRemaining%60;return`${e}:${t.toString().padStart(2,"0")}`}endAppeal(){this.stopTimer(),this.completed.emit()}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=k({type:a,selectors:[["app-appeal-dialog"]],inputs:{teamName:"teamName",durationSeconds:"durationSeconds"},outputs:{completed:"completed"},decls:14,vars:9,consts:[[1,"dialog-overlay"],[1,"dialog-content"],[1,"appeal-message"],[1,"timer-display"],[1,"timer-value"],["class","timer-label",4,"ngIf"],["class","timer-label expired-label",4,"ngIf"],[1,"dialog-actions"],[1,"btn","btn-primary",3,"click"],[1,"timer-label"],[1,"timer-label","expired-label"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"div",1)(2,"h2"),c(3),r(),o(4,"p",2),c(5,"Coach may approach the Quiz Master"),r(),o(6,"div",3)(7,"div",4),c(8),r(),v(9,yt,2,0,"div",5)(10,wt,2,0,"div",6),r(),o(11,"div",7)(12,"button",8),_("click",function(){return i.endAppeal()}),c(13),r()()()()),t&2&&(s(3),P("",i.teamName," Appeal"),s(3),x("warning",i.timeRemaining<=10&&i.timeRemaining>0)("expired",i.timeRemaining===0),s(2),O(i.getTimerDisplay()),s(),d("ngIf",i.timeRemaining>0),s(),d("ngIf",i.timeRemaining===0),s(3),P(" ",i.timeRemaining===0?"Close":"End Appeal Early"," "))},dependencies:[D,Q],styles:[".dialog-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0009;display:flex;align-items:center;justify-content:center;z-index:1000;padding:var(--spacing-md)}.dialog-content[_ngcontent-%COMP%]{background:var(--xl-white);border-radius:var(--radius-lg);box-shadow:var(--shadow-xl);padding:var(--spacing-lg);max-width:400px;width:100%;display:flex;flex-direction:column;gap:var(--spacing-lg);text-align:center}.dialog-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:700;color:var(--xl-blue-dark);font-family:var(--font-heading)}.appeal-message[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;font-weight:600;color:var(--xl-blue-dark);padding:var(--spacing-sm);background:var(--xl-blue-lighter);border-radius:var(--radius-md)}.timer-display[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-xl);background:var(--xl-gray-lighter);border-radius:var(--radius-lg);border:3px solid var(--xl-blue);transition:all var(--transition-base)}.timer-display.warning[_ngcontent-%COMP%]{border-color:var(--xl-gold);background:var(--xl-gold-lighter);animation:_ngcontent-%COMP%_pulse-warning 1s infinite}.timer-display.expired[_ngcontent-%COMP%]{border-color:var(--xl-red);background:var(--xl-red-lighter)}.timer-value[_ngcontent-%COMP%]{font-size:4rem;font-weight:700;color:var(--xl-blue-dark);font-family:Courier New,monospace;line-height:1}.timer-display.warning[_ngcontent-%COMP%]   .timer-value[_ngcontent-%COMP%]{color:var(--xl-gold-dark)}.timer-display.expired[_ngcontent-%COMP%]   .timer-value[_ngcontent-%COMP%]{color:var(--xl-red-dark)}.timer-label[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:var(--xl-gray-dark);text-transform:uppercase;letter-spacing:.05em}.expired-label[_ngcontent-%COMP%]{color:var(--xl-red-dark)}.dialog-actions[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm);justify-content:center}.dialog-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:var(--spacing-sm) var(--spacing-lg);font-size:1rem;min-width:180px}.btn-primary[_ngcontent-%COMP%]{background:var(--xl-blue);color:var(--xl-white);border:2px solid var(--xl-blue-dark);border-radius:var(--radius-md);cursor:pointer;font-weight:600;transition:all var(--transition-base)}.btn-primary[_ngcontent-%COMP%]:hover{background:var(--xl-blue-dark)}@keyframes _ngcontent-%COMP%_pulse-warning{0%{box-shadow:0 0 #f59e0bb3}50%{box-shadow:0 0 0 10px #f59e0b00}to{box-shadow:0 0 #f59e0b00}}@media (max-width: 768px){.dialog-content[_ngcontent-%COMP%]{max-width:100%;margin:var(--spacing-sm)}.timer-value[_ngcontent-%COMP%]{font-size:3rem}.dialog-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}"]})};var Pt=(a,e)=>({warning:a,expired:e});function Ot(a,e){if(a&1&&(o(0,"span",32),c(1),r()),a&2){let t=m(2);s(),P("ID: ",t.questionID)}}function Tt(a,e){if(a&1){let t=I();o(0,"button",33),_("click",function(){y(t);let n=m(2);return w(n.toggleFlagQuestion())}),c(1),r()}if(a&2){let t=m(2);x("flagged",t.isQuestionFlagged()),d("title",G(t.isQuestionFlagged()?"Unflag this question":"Flag for review")),s(),P(" ",t.isQuestionFlagged()?"\u{1F6A9} Flagged":"\u2691 Flag"," ")}}function Mt(a,e){if(a&1&&(o(0,"span",34),c(1),r()),a&2){let t=m(2);s(),P(" (",t.getFlaggedQuestionsCount()," flagged) ")}}function It(a,e){if(a&1&&(o(0,"span",45),c(1),r()),a&2){let t=m(3);s(),P("ID ",t.questionID)}}function qt(a,e){if(a&1&&(o(0,"span",46),c(1),r()),a&2){let t=m(3);s(),O(t.referenceLabel)}}function Nt(a,e){if(a&1&&(o(0,"span",46),c(1),r()),a&2){let t=m(4);s(),O(t.referenceLabel)}}function kt(a,e){if(a&1&&(o(0,"div",51),c(1),r()),a&2){let t=m(4);s(),O(t.verseText)}}function Qt(a,e){if(a&1&&(o(0,"div",52),c(1),r()),a&2){let t=m(4);s(),O(t.verseWarning)}}function Dt(a,e){if(a&1&&(o(0,"div",47)(1,"div",48)(2,"h3"),c(3,"Verse"),r(),v(4,Nt,2,1,"span",40),r(),v(5,kt,2,1,"div",49)(6,Qt,2,1,"div",50),r()),a&2){let t=m(3);s(4),d("ngIf",t.referenceLabel),s(),d("ngIf",t.verseText),s(),d("ngIf",!t.verseText&&t.verseWarning)}}function Et(a,e){if(a&1&&(R(0),o(1,"div",35)(2,"div",36)(3,"div",37)(4,"span",38),c(5),r(),v(6,It,2,1,"span",39)(7,qt,2,1,"span",40),r()(),o(8,"div",41)(9,"div",42)(10,"h3"),c(11,"Question"),r(),o(12,"div",43),c(13),r()(),o(14,"div",42)(15,"h3"),c(16,"Answer"),r(),o(17,"div",43),c(18),r()()(),v(19,Dt,7,3,"div",44),r(),$()),a&2){let t=m(2);s(5),O(t.questionTypeLabel),s(),d("ngIf",t.questionID),s(),d("ngIf",t.referenceLabel),s(6),E("",t.questionIntro," Question: ",t.questionText),s(5),O(t.answerText),s(),d("ngIf",t.verseText||t.verseWarning)}}function zt(a,e){a&1&&(o(0,"p"),c(1,'Click "First Question" to begin the match.'),r())}function Rt(a,e){a&1&&(o(0,"p"),c(1,'No active question. Use "Next Question" to continue.'),r())}function $t(a,e){a&1&&(o(0,"p",57),c(1," \u26A0\uFE0F No questions available in this set. Please select a different question set. "),r())}function Vt(a,e){if(a&1&&(o(0,"p",58),c(1),r()),a&2){let t=m(3);s(),E(" \u2713 ",t.availableQuestions.length,' questions available in set "',t.setID,'" ')}}function At(a,e){if(a&1&&(o(0,"div",35)(1,"div",53),v(2,zt,2,0,"p",54)(3,Rt,2,0,"p",54)(4,$t,2,0,"p",55)(5,Vt,2,2,"p",56),r()()),a&2){let t=m(2);s(2),d("ngIf",t.questionNum===0),s(),d("ngIf",t.questionNum>0),s(),d("ngIf",t.availableQuestions.length===0),s(),d("ngIf",t.availableQuestions.length>0)}}function Ft(a,e){a&1&&(o(0,"span",63),c(1,"TIME"),r())}function Bt(a,e){if(a&1&&(o(0,"small",64),c(1),r()),a&2){let t=m(3);s(),E(" Speak \u2264 ",t.settings.speakWaitSeconds,"s \u2022 Answer \u2264 ",t.settings.answerTimeSeconds,"s ")}}function Lt(a,e){if(a&1&&(o(0,"div",59)(1,"span",60),c(2),r(),v(3,Ft,2,0,"span",61)(4,Bt,2,2,"small",62),r()),a&2){let t=m(2);d("ngClass",K(4,Pt,t.timerWarn&&!t.timerExpired,t.timerExpired)),s(2),O(t.getTimerDisplay()),s(),d("ngIf",t.timerExpired),s(),d("ngIf",t.settings&&!t.timerExpired)}}function Wt(a,e){if(a&1){let t=I();o(0,"div",65)(1,"button",66),_("click",function(){y(t);let n=m(2);return w(n.onCorrect())}),c(2,"Correct"),r(),o(3,"button",67),_("click",function(){y(t);let n=m(2);return w(n.onWrong())}),c(4,"Wrong"),r(),o(5,"button",68),_("click",function(){y(t);let n=m(2);return w(n.onFoul())}),c(6,"Foul"),r()()}if(a&2){let t=m(2);x("no-player-selected",t.selectedTeam1Chair===-1&&t.selectedTeam2Chair===-1&&!(t.matchState!=null&&t.matchState.bonusQuestion))}}function jt(a,e){if(a&1){let t=I();o(0,"button",12),_("click",function(){y(t);let n=m(2);return w(n.onReplayQuestion())}),c(1," Replay Question "),r()}}function Ut(a,e){if(a&1&&(o(0,"div",72)(1,"div",73)(2,"span",74),c(3,"\u2713"),r(),o(4,"span",74),c(5,"\u2713"),r(),o(6,"span",74),c(7,"\u2713"),r(),o(8,"span",74),c(9,"\u2713"),r()(),o(10,"div",75)(11,"span",74),c(12,"\u2717"),r(),o(13,"span",74),c(14,"\u2717"),r(),o(15,"span",74),c(16,"\u2717"),r()()()),a&2){let t=m().$implicit,i=m(2);s(2),x("filled",i.getPlayerCorrect(1,t.playerNumber)>=1),s(2),x("filled",i.getPlayerCorrect(1,t.playerNumber)>=2),s(2),x("filled",i.getPlayerCorrect(1,t.playerNumber)>=3),s(2),x("filled",i.getPlayerCorrect(1,t.playerNumber)>=4),s(3),x("filled",i.getPlayerErrors(1,t.playerNumber)>=1),s(2),x("filled",i.getPlayerErrors(1,t.playerNumber)>=2),s(2),x("filled",i.getPlayerErrors(1,t.playerNumber)>=3)}}function Ht(a,e){if(a&1){let t=I();o(0,"div",69),_("click",function(){let n=y(t).index,l=m(2);return w(l.onTeam1ChairSelect(n))}),o(1,"div",70)(2,"span"),c(3),r(),v(4,Ut,17,14,"div",71),r()()}if(a&2){let t=e.$implicit,i=e.index,n=m(2);x("selected",n.selectedTeam1Chair===i)("disabled",!t||t.playerNumber===0)("quiz-out",t&&n.isPlayerQuizOut(t.playerNumber))("error-out",t&&n.isPlayerErrorOut(t.playerNumber))("bonus-only",(t==null?null:t.bonusOnly)&&!n.isPlayerErrorOut(t==null?null:t.playerNumber))("fouled-question",t&&n.isPlayerFouled(t.playerNumber)),s(3),E("Chair #",i+1,": ",t?t.name:"Empty"),s(),d("ngIf",t&&t.playerNumber>0)}}function Jt(a,e){if(a&1&&(o(0,"div",72)(1,"div",73)(2,"span",74),c(3,"\u2713"),r(),o(4,"span",74),c(5,"\u2713"),r(),o(6,"span",74),c(7,"\u2713"),r(),o(8,"span",74),c(9,"\u2713"),r()(),o(10,"div",75)(11,"span",74),c(12,"\u2717"),r(),o(13,"span",74),c(14,"\u2717"),r(),o(15,"span",74),c(16,"\u2717"),r()()()),a&2){let t=m().$implicit,i=m(2);s(2),x("filled",i.getPlayerCorrect(2,t.playerNumber)>=1),s(2),x("filled",i.getPlayerCorrect(2,t.playerNumber)>=2),s(2),x("filled",i.getPlayerCorrect(2,t.playerNumber)>=3),s(2),x("filled",i.getPlayerCorrect(2,t.playerNumber)>=4),s(3),x("filled",i.getPlayerErrors(2,t.playerNumber)>=1),s(2),x("filled",i.getPlayerErrors(2,t.playerNumber)>=2),s(2),x("filled",i.getPlayerErrors(2,t.playerNumber)>=3)}}function Zt(a,e){if(a&1){let t=I();o(0,"div",69),_("click",function(){let n=y(t).index,l=m(2);return w(l.onTeam2ChairSelect(n))}),o(1,"div",70)(2,"span"),c(3),r(),v(4,Jt,17,14,"div",71),r()()}if(a&2){let t=e.$implicit,i=e.index,n=m(2);x("selected",n.selectedTeam2Chair===i)("disabled",!t||t.playerNumber===0)("quiz-out",t&&n.isPlayerQuizOut(t.playerNumber))("error-out",t&&n.isPlayerErrorOut(t.playerNumber))("bonus-only",(t==null?null:t.bonusOnly)&&!n.isPlayerErrorOut(t==null?null:t.playerNumber))("fouled-question",t&&n.isPlayerFouled(t.playerNumber)),s(3),E("Chair #",i+1,": ",t?t.name:"Empty"),s(),d("ngIf",t&&t.playerNumber>0)}}function Gt(a,e){if(a&1){let t=I();o(0,"div",4)(1,"div",5)(2,"div",6)(3,"span",7),c(4),r(),v(5,Ot,2,1,"span",8),o(6,"span",9),c(7),r(),v(8,Tt,2,5,"button",10)(9,Mt,2,1,"span",11),r(),o(10,"button",12),_("click",function(){y(t);let n=m();return w(n.onEndMatch())}),c(11,"End Match"),r()(),o(12,"div",13)(13,"div",14),v(14,Et,20,7,"ng-container",15)(15,At,6,4,"ng-template",null,0,X),o(17,"div",16),v(18,Lt,5,7,"div",17)(19,Wt,7,2,"div",18),o(20,"div",19)(21,"button",20),_("click",function(){y(t);let n=m();return w(n.onNextQuestion())}),c(22),r(),v(23,jt,2,0,"button",21),r()()(),o(24,"div",22)(25,"div",23)(26,"div",24)(27,"div",25)(28,"h2"),c(29),r(),o(30,"div",26)(31,"span"),c(32),r(),o(33,"span"),c(34),r(),o(35,"span"),c(36),r()()(),o(37,"div",27),v(38,Ht,5,15,"div",28),r(),o(39,"div",29)(40,"button",30),_("click",function(){y(t);let n=m();return w(n.onTimeout(1))}),c(41,"Timeout"),r(),o(42,"button",30),_("click",function(){y(t);let n=m();return w(n.onSubstitute(1))}),c(43,"Substitute"),r(),o(44,"button",30),_("click",function(){y(t);let n=m();return w(n.onAppeal(1))}),c(45,"Appeal"),r()()(),o(46,"div",31)(47,"div",25)(48,"h2"),c(49),r(),o(50,"div",26)(51,"span"),c(52),r(),o(53,"span"),c(54),r(),o(55,"span"),c(56),r()()(),o(57,"div",27),v(58,Zt,5,15,"div",28),r(),o(59,"div",29)(60,"button",30),_("click",function(){y(t);let n=m();return w(n.onTimeout(2))}),c(61,"Timeout"),r(),o(62,"button",30),_("click",function(){y(t);let n=m();return w(n.onSubstitute(2))}),c(63,"Substitute"),r(),o(64,"button",30),_("click",function(){y(t);let n=m();return w(n.onAppeal(2))}),c(65,"Appeal"),r()()()()()()()}if(a&2){let t=Z(16),i=m();s(3),x("bonus-active",i.matchState.bonusQuestion),s(),E(" ",i.matchState.bonusQuestion?"BONUS":"Question"," ",i.questionNum||0," "),s(),d("ngIf",i.questionID),s(2),O(i.setID),s(),d("ngIf",i.currentQuestion),s(),d("ngIf",i.getFlaggedQuestionsCount()>0),s(5),d("ngIf",i.currentQuestion)("ngIfElse",t),s(4),d("ngIf",i.timerActive),s(),d("ngIf",i.currentQuestion),s(2),x("attention",i.matchState==null?null:i.matchState.finishQuest)("disabled-fade",i.currentQuestion&&!(i.matchState!=null&&i.matchState.finishQuest)),s(),P(" ",i.questionNum===0?"First Question":"Next Question"," "),s(),d("ngIf",i.questionNum>0&&i.currentQuestion),s(3),j("background-color",i.getTeam1Color()),s(3),O(i.matchState.team1Team),s(3),P("Score: ",i.matchState.team1Score),s(2),P("TOs: ",i.matchState.team1TOs),s(2),P("Appeals: ",i.matchState.team1Appeals),s(2),d("ngForOf",i.matchState.team1Chairs),s(8),j("background-color",i.getTeam2Color()),s(3),O(i.matchState.team2Team),s(3),P("Score: ",i.matchState.team2Score),s(2),P("TOs: ",i.matchState.team2TOs),s(2),P("Appeals: ",i.matchState.team2Appeals),s(2),d("ngForOf",i.matchState.team2Chairs)}}function Kt(a,e){if(a&1){let t=I();o(0,"div",4)(1,"div",76)(2,"h2"),c(3,"No active match"),r(),o(4,"p"),c(5,"Please select a question set and teams to start a match."),r(),o(6,"button",20),_("click",function(){y(t);let n=m();return w(n.onStartMatch())}),c(7,"Start Match"),r()()()}}function Xt(a,e){if(a&1){let t=I();o(0,"app-substitution-dialog",77),_("confirmed",function(n){y(t);let l=m();return w(l.onSubDialogConfirm(n))})("swapConfirmed",function(n){y(t);let l=m();return w(l.onSwapDialogConfirm(n))})("cancelled",function(){y(t);let n=m();return w(n.onSubDialogCancel())}),r()}if(a&2){let t=m();d("teamName",t.subDialogTeamName)("chairs",t.subDialogChairs)("availableSubs",t.subDialogAvailableSubs)("autoSubChairIndex",t.subDialogAutoChairIndex)("autoSubReason",t.subDialogAutoReason)}}function Yt(a,e){if(a&1){let t=I();o(0,"app-timeout-dialog",78),_("completed",function(){y(t);let n=m();return w(n.onTimeoutComplete())}),r()}if(a&2){let t=m();d("teamName",t.timeoutTeamName)("durationSeconds",t.timeoutDuration)}}function te(a,e){if(a&1){let t=I();o(0,"app-appeal-dialog",78),_("completed",function(){y(t);let n=m();return w(n.onAppealComplete())}),r()}if(a&2){let t=m();d("teamName",t.appealTeamName)("durationSeconds",t.appealDuration)}}var rt=class a{constructor(e,t,i,n){this.dbService=e;this.quizState=t;this.router=i;this.tournamentService=n}matchState=null;currentQuestion=null;questionText="";answerText="";verseText="";verseWarning="";questionID=null;questionNum=0;setID="";questionIntro="";questionTypeLabel="";referenceLabel="";settings=null;selectedTeam1Chair=-1;selectedTeam2Chair=-1;questionAnswered=!1;fouledPlayers=new Set;quizOutPlayers=new Set;errorOutPlayers=new Set;flaggedQuestions=new Set;currentBonusQuestionID=null;parms=null;questArr=[];availableQuestions=[];timer=0;timerInterval=null;timerActive=!1;timerWarn=!1;timerExpired=!1;showSubDialog=!1;subDialogTeamName="";subDialogChairs=[];subDialogAvailableSubs=[];subDialogAutoChairIndex=null;subDialogAutoReason="";subDialogTeam=1;subDialogResolve=null;showTimeoutDialog=!1;timeoutTeamName="";timeoutDuration=60;showAppealDialog=!1;appealTeamName="";appealDuration=90;pendingSubstitution=null;verseMap=new Map;questionTypeMap=new Map;typeCacheInitialized=!1;ngOnInit(){return C(this,null,function*(){if(this.matchState=this.quizState.getMatchState(),!this.matchState){this.router.navigate(["/select-question"]);return}this.settings=this.matchState.matchSettings??null,this.matchState.verseLookupEntries&&(this.verseMap=new Map(this.matchState.verseLookupEntries)),this.matchState.questionTypeEntries&&(this.questionTypeMap=new Map(this.matchState.questionTypeEntries),this.typeCacheInitialized=!0),this.questionNum=this.matchState.questionNum||0,this.setID=this.matchState.setID||"",yield this.loadParms(),yield this.loadQuestionSet(),this.questionNum>0&&this.matchState.currentQuestionID&&(yield this.loadQuestion(this.matchState.currentQuestionID));let e=sessionStorage.getItem("flaggedQuestions");if(e)try{let t=JSON.parse(e);this.flaggedQuestions=new Set(t)}catch(t){console.error("Failed to load flagged questions:",t)}this.updateDisplay()})}ngOnDestroy(){this.timerInterval&&clearInterval(this.timerInterval)}loadParms(){return C(this,null,function*(){let e=yield this.dbService.getUserFile();e&&(this.parms=yield this.dbService.getParms(e.book),this.parms||(this.parms={book:e.book,quizOutNum:4,errOutNum:3,foulOutNum:3,timeouts:2,matchLength:20,quizOutPoints:10,errOutPoints:10,foulOutPoints:10,penaltyNum:17,corrPoints:20,bonusPoints:10,tieBreaker:3}))})}loadQuestionSet(){return C(this,null,function*(){if(!this.matchState.setID){this.availableQuestions=[];return}let e=this.matchState.setID,t=()=>C(this,null,function*(){let n=(yield this.dbService.getQuizSet(e)).map(l=>({questNum:l.questNum,bonusNum:l.bonusNum}));this.matchState.questionQueue=n,this.matchState.questionIds=n.map(l=>l.questNum),this.matchState.totalQuestions=n.length,this.matchState.questionHistory=[],this.availableQuestions=[...this.matchState.questionIds||[]],this.questArr=n.map(l=>l.questNum),this.quizState.setMatchState(V({},this.matchState)),this.matchState=this.quizState.getMatchState(),console.log(`Loaded ${n.length} questions from set ${e}`)});this.matchState.questionQueue&&this.matchState.questionQueue.length>0?(this.availableQuestions=this.matchState.questionQueue.map(i=>i.questNum),this.questArr=this.availableQuestions.map(i=>i),console.log(`Loaded ${this.availableQuestions.length} cached questions from set ${e}`)):yield t(),this.availableQuestions.length===0&&console.warn(`Question set ${e} returned no questions.`)})}loadQuestion(e){return C(this,null,function*(){console.log(`Loading question ID: ${e}`);let t=null;if(this.matchState.questionLookupEntries&&(t=new Map(this.matchState.questionLookupEntries).get(e)||null),!t&&this.matchState.questionBank&&(t=this.matchState.questionBank.find(l=>l.questionID===e)||null),t||(t=yield this.dbService.getQuestion(e)),!t){console.error(`Question ${e} not found in database or dataset cache`),alert(`Question ${e} not found. Please check your question data.`);return}this.currentQuestion=t,this.questionID=e,this.questionText=(t.qdescription||"").trim(),this.answerText=(t.qAnswer||"").trim();let n=(yield this.getQuestionTypeInfo(t.qDescType))?.leadIn?.trim()||"a question";if(this.questionIntro=`Question number ${this.questionNum} is ${this.formatLeadIn(n)}.`,this.questionTypeLabel=this.buildQuestionTypeLabel(n,t.qDescType),t.qChapter){let l=(this.parms?.book||"").trim(),S=!n.toLowerCase().includes("chapter only")&&t.qBegVerse&&t.qBegVerse>0;if(S){let f=`${l?l+" ":""}${t.qChapter}:${t.qBegVerse}`;t.qEndVerse&&t.qEndVerse!==t.qBegVerse&&(f+=`-${t.qEndVerse}`),this.referenceLabel=f}else this.referenceLabel=`${l?l+" ":""}${t.qChapter}`;if(this.questionText){if(this.questionText&&n.toLowerCase().includes("reference")){let f="According to ";l&&(f+=`${l} `),f+=`Chapter ${t.qChapter}`,S&&(f+=` Verse ${t.qBegVerse}`,t.qEndVerse&&t.qEndVerse!==t.qBegVerse&&(f+=` through ${t.qEndVerse}`)),this.questionText=`${f} ${this.questionText}`}}else{let f=l?l+" ":"";S?(f+=`Chapter ${t.qChapter} Verse ${t.qBegVerse}`,t.qEndVerse&&t.qEndVerse!==t.qBegVerse&&(f+=` through ${t.qEndVerse}`)):f+=`Chapter ${t.qChapter}`,this.questionText=`Quote ${f}`}}else this.referenceLabel="";if(t.qChapter&&t.qBegVerse){let l=yield this.getVerseRangeText(t.qChapter,t.qBegVerse,t.qEndVerse||t.qBegVerse);if(l)this.verseText=l,this.verseWarning="";else{let h=`${t.qChapter}:${t.qBegVerse}${t.qEndVerse&&t.qEndVerse!==t.qBegVerse?"-"+t.qEndVerse:""}`;this.verseText="",this.verseWarning=`Verse ${h} not found in dataset.`}}else this.verseText="",this.verseWarning=""})}getQuestionTypeInfo(e){return C(this,null,function*(){return e?this.questionTypeMap.has(e)?this.questionTypeMap.get(e)||null:(this.typeCacheInitialized||((yield this.dbService.getAllTypes()).forEach(i=>{this.questionTypeMap.set(i.typeID,{leadIn:(i.leadIn||"").trim(),class:i.class?.trim()||void 0})}),this.typeCacheInitialized=!0),this.questionTypeMap.get(e)||null):null})}getVerseRangeText(e,t,i){return C(this,null,function*(){if(!e||!t)return"";let n=Math.min(t,i||t),l=Math.max(t,i||t),h=[],S=!0;if(this.verseMap.size){for(let M=n;M<=l;M++){let p=`${e}:${M}`,u=this.verseMap.get(p);if(!u){S=!1;break}h.push(`${e}:${M} ${u}`.trim())}if(S&&h.length)return h.join(`
`);h.length=0}return(yield this.dbService.getVerses(e,n,l))||""})}formatLeadIn(e){let t=e.replace(/\s+/g," ").trim();if(!t)return"a question";let i=t.toLowerCase();if(i.startsWith("an ")){let n=t.slice(3);return"an "+n.charAt(0).toUpperCase()+n.slice(1)}if(i.startsWith("a ")){let n=t.slice(2);return"a "+n.charAt(0).toUpperCase()+n.slice(1)}return t.charAt(0).toUpperCase()+t.slice(1)}buildQuestionTypeLabel(e,t){let i=e.replace(/\s+/g," ").replace(/^(a|an)\s+/i,"").replace(/\s*question\.?$/i,"").trim();return i?this.toTitleCase(i):t?t.toUpperCase():"QUESTION"}toTitleCase(e){return e.toLowerCase().split(/\s+/).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}updateDisplay(){this.matchState}handleChairSelection(e,t,i={}){if(!this.matchState)return!1;let l=(e===1?this.matchState.team1Chairs:this.matchState.team2Chairs)[t];if(!l||l.playerNumber===0)return i.auto||alert("No player is assigned to that chair."),!1;let h=this.getRosterEntry(e,l.playerNumber),S=this.matchState.bonusQuestion;return h?this.errorOutPlayers.has(l.playerNumber)||h.errorOut?(alert(S?`${l.name} has errored out and is NOT eligible to answer bonus questions.`:`${l.name} has errored out and cannot answer.`),!1):!S&&(this.quizOutPlayers.has(l.playerNumber)||h.quizOut)?(i.auto||alert(`${l.name} has quizzed out and may only answer bonus questions.`),!1):(e===1?(this.selectedTeam1Chair=t,this.selectedTeam2Chair=-1):(this.selectedTeam2Chair=t,this.selectedTeam1Chair=-1),i.skipTimer||this.startTimer(),!0):(i.auto||alert("Unable to locate player in roster."),!1)}getRosterEntry(e,t){return this.matchState?(e===1?this.matchState.team1Roster:this.matchState.team2Roster).find(n=>n.playerNumber===t):void 0}updateChairStatus(e,t){if(!this.matchState)return;let n=(e===1?this.matchState.team1Chairs:this.matchState.team2Chairs).find(l=>l&&l.playerNumber===t.playerNumber);n&&(n.quizOut=t.quizOut,n.errorOut=t.errorOut,n.bonusOnly=t.bonusOnly)}handleQuizOutIfNeeded(e,t){return C(this,null,function*(){let i=this.settings;if(console.log("handleQuizOutIfNeeded:",{settings:i,rosterEntry:t,quizOutCorrect:i?.quizOutCorrect,playerCorrect:t.correct,alreadyQuizOut:t.quizOut}),!i||t.quizOut){console.log("Quiz-out check skipped: no settings or already quizzed out");return}if(t.correct<i.quizOutCorrect){console.log(`Not enough correct answers for quiz-out: ${t.correct} < ${i.quizOutCorrect}`);return}console.log("Player has quizzed out!"),t.quizOut=!0,this.quizOutPlayers.add(t.playerNumber);let n=this.hasAvailableSubstitute(e);console.log("Has available substitute:",n),t.bonusOnly=!0,this.updateChairStatus(e,t),i.quizOutBonusPoints&&(e===1?this.matchState.team1Score+=i.quizOutBonusPoints:this.matchState.team2Score+=i.quizOutBonusPoints);let l=this.getPlayerLabel(e,t.playerNumber);n?(alert(`${l} has quizzed out and will be substituted. They can still answer bonus questions if subbed back in.`),yield this.showSubstituteDialog(e,!0)):alert(`${l} has quizzed out. No substitutes remain, so they may only answer bonus questions.`)})}handleErrorOutIfNeeded(e,t){return C(this,null,function*(){let i=this.settings;if(!i||t.errorOut||t.errors<i.errorOutMisses)return;t.errorOut=!0,this.errorOutPlayers.add(t.playerNumber);let n=this.hasAvailableSubstitute(e);t.bonusOnly=!1,this.updateChairStatus(e,t),i.errorOutPenaltyPoints&&(e===1?this.matchState.team1Score+=i.errorOutPenaltyPoints:this.matchState.team2Score+=i.errorOutPenaltyPoints);let l=this.getPlayerLabel(e,t.playerNumber);n?(this.pendingSubstitution={team:e,reason:"errored out"},alert(`${l} has errored out and will be substituted after the bonus question.

\u26A0\uFE0F REMINDER: ${l} is NOT eligible to answer bonus questions.`)):alert(`${l} has errored out. No substitutes remain.

\u26A0\uFE0F REMINDER: ${l} is NOT eligible to answer any questions, including bonus questions.`)})}handleFoulOutIfNeeded(e,t){return C(this,null,function*(){let i=this.settings;if(!i)return;let n=i.foulsToFoulOut||this.parms?.foulOutNum||2;if(t.fouls<n)return;t.errorOut=!0;let l=this.hasAvailableSubstitute(e);t.bonusOnly=!1,this.updateChairStatus(e,t);let h=i.foulOutPenalty??this.parms?.foulOutPoints??-10;h&&(e===1?this.matchState.team1Score+=h:this.matchState.team2Score+=h);let S=this.getPlayerLabel(e,t.playerNumber);l?(this.pendingSubstitution={team:e,reason:"fouled out"},alert(`${S} has fouled out and will be substituted after this question.`)):alert(`${S} has fouled out. No substitutes remain, so they may not answer any questions.`)})}processPendingSubstitution(){return C(this,null,function*(){if(!this.pendingSubstitution)return;let{team:e}=this.pendingSubstitution;this.pendingSubstitution=null,yield this.showSubstituteDialog(e,!0)})}getPlayerLabel(e,t){if(!this.matchState)return"Player";let n=(e===1?this.matchState.team1Chairs:this.matchState.team2Chairs).find(h=>h&&h.playerNumber===t);if(n?.name)return n.name;let l=this.getRosterEntry(e,t);return l?`Player #${l.playerNumber}`:"Player"}hasAvailableSubstitute(e){if(!this.matchState)return!1;let t=e===1?this.matchState.team1Roster:this.matchState.team2Roster,i=e===1?this.matchState.team1Chairs:this.matchState.team2Chairs,n=new Set;return i.forEach(l=>{l&&l.playerNumber&&n.add(l.playerNumber)}),t.some(l=>!n.has(l.playerNumber))}prepareBonusQuestion(e,t){return C(this,null,function*(){if(!this.matchState)return!1;let i=e===1?2:1,l=(i===1?this.matchState.team1Chairs:this.matchState.team2Chairs)[t];if(!l||!l.playerNumber)return!1;if(this.errorOutPlayers.has(l.playerNumber))return alert(`${l.name} has errored out and is NOT eligible to answer bonus questions.`),!1;let h=this.getRosterEntry(i,l.playerNumber);return h?h.errorOut?(alert(`${l.name} has errored out and is NOT eligible to answer bonus questions.`),!1):(this.matchState.bonusQuestion=!0,this.matchState.pendingBonusTeam=i,this.matchState.pendingBonusSeat=t,this.matchState.finishQuest=!1,yield this.loadBonusQuestion(),alert(`Bonus question for ${l.name}. Click on their name to start the clock.`),i===1?(this.selectedTeam1Chair=t,this.selectedTeam2Chair=-1):(this.selectedTeam2Chair=t,this.selectedTeam1Chair=-1),!0):!1})}loadBonusQuestion(){return C(this,null,function*(){if(!this.matchState||!this.currentQuestion)return;let e=this.currentQuestion.questionID,t=null;if(this.matchState.questionHistory&&this.matchState.questionHistory.length>0){let n=(yield this.dbService.getQuizSet(this.setID)).find(l=>l.questNum===e);n&&n.bonusNum&&n.bonusNum>0&&(t=n.bonusNum)}t&&t!==e?(console.log(`Loading bonus question ID: ${t} (original was ${e})`),this.currentBonusQuestionID=t,yield this.loadQuestion(t),this.questionIntro=`BONUS: ${this.questionIntro}`):(console.log("No separate bonus question found, using same question"),this.currentBonusQuestionID=null)})}onTeam1ChairSelect(e){this.handleChairSelection(1,e)}onTeam2ChairSelect(e){this.handleChairSelection(2,e)}onJumpIn(){return C(this,null,function*(){if(this.selectedTeam1Chair===-1&&this.selectedTeam2Chair===-1){alert("Please select a player");return}this.startTimer()})}onCorrect(){return C(this,null,function*(){if(!this.currentQuestion||!this.matchState)return;let e=this.selectedTeam1Chair!==-1?1:2,t=e===1?this.selectedTeam1Chair:this.selectedTeam2Chair,i=e===1?this.matchState.team1Chairs[t]:this.matchState.team2Chairs[t];if(!i||i.playerNumber===0){alert("Please select a player");return}if(this.fouledPlayers.has(i.playerNumber)){alert(`${i.name} has been fouled on this question and cannot answer it.`);return}if(!this.matchState.bonusQuestion&&this.questionAnswered){alert("This question has already been answered. Only one player can score per question.");return}let n=this.parms?.corrPoints??20,l=this.settings?.bonusQuestionPoints??this.parms?.bonusPoints??10,h=this.matchState.bonusQuestion?l:n;this.matchState.bonusQuestion||(this.matchState.team1Chairs.forEach(f=>{f&&(f.lastAnswerCorrect=null)}),this.matchState.team2Chairs.forEach(f=>{f&&(f.lastAnswerCorrect=null)})),i.lastAnswerCorrect=!0,this.matchState.bonusQuestion||(this.questionAnswered=!0),e===1?this.matchState.team1Score+=h:this.matchState.team2Score+=h;let S=e===1?this.matchState.team1Roster.findIndex(f=>f.playerNumber===i.playerNumber):this.matchState.team2Roster.findIndex(f=>f.playerNumber===i.playerNumber);if(S>=0){let f=e===1?this.matchState.team1Roster:this.matchState.team2Roster;f[S].activeQuestions++,this.matchState.bonusQuestion?f[S].bonusCorrect++:(f[S].correct++,this.handleQuizOutIfNeeded(e,f[S]))}yield this.recordAction("Correct",i.playerNumber,h),this.matchState.finishQuest=!0,this.matchState.bonusQuestion=!1,this.matchState.pendingBonusTeam=null,this.matchState.pendingBonusSeat=null,this.quizState.setMatchState(this.matchState),this.updateDisplay(),this.stopTimer(),yield this.processPendingSubstitution()})}onWrong(){return C(this,null,function*(){if(!this.currentQuestion||!this.matchState)return;let e=this.selectedTeam1Chair!==-1?1:2,t=e===1?this.selectedTeam1Chair:this.selectedTeam2Chair,i=e===1?this.matchState.team1Chairs[t]:this.matchState.team2Chairs[t];if(!i||i.playerNumber===0){alert("Please select a player");return}if(this.fouledPlayers.has(i.playerNumber)){alert(`${i.name} has been fouled on this question and cannot answer it.`);return}if(!this.matchState.bonusQuestion&&this.questionAnswered){alert("This question has already been answered. Only one player can score per question.");return}this.stopTimer(),this.matchState.bonusQuestion||(this.matchState.team1Chairs.forEach(h=>{h&&(h.lastAnswerCorrect=null)}),this.matchState.team2Chairs.forEach(h=>{h&&(h.lastAnswerCorrect=null)})),i.lastAnswerCorrect=!1,this.matchState.bonusQuestion||(this.questionAnswered=!0);let n=e===1?this.matchState.team1Roster.findIndex(h=>h.playerNumber===i.playerNumber):this.matchState.team2Roster.findIndex(h=>h.playerNumber===i.playerNumber);if(n>=0){let h=e===1?this.matchState.team1Roster:this.matchState.team2Roster;this.matchState.bonusQuestion?h[n].bonusErrors++:(h[n].errors++,e===1?this.matchState.team1Errors++:this.matchState.team2Errors++,this.handleErrorOutIfNeeded(e,h[n]))}let l=this.matchState.bonusQuestion;yield this.recordAction("Wrong",i.playerNumber,0),l?(this.matchState.bonusQuestion=!1,this.matchState.pendingBonusTeam=null,this.matchState.pendingBonusSeat=null,this.matchState.finishQuest=!0,this.currentBonusQuestionID=null):(yield this.prepareBonusQuestion(e,t))||(this.matchState.finishQuest=!0),this.quizState.setMatchState(this.matchState),this.updateDisplay(),this.matchState.finishQuest&&(yield this.processPendingSubstitution())})}onFoul(){return C(this,null,function*(){if(!this.currentQuestion||!this.matchState)return;let e=this.selectedTeam1Chair!==-1?1:2,t=e===1?this.selectedTeam1Chair:this.selectedTeam2Chair,i=e===1?this.matchState.team1Chairs[t]:this.matchState.team2Chairs[t];if(!i||i.playerNumber===0){alert("Please select a player");return}let n=e===1?this.matchState.team1Roster.findIndex(l=>l.playerNumber===i.playerNumber):this.matchState.team2Roster.findIndex(l=>l.playerNumber===i.playerNumber);if(n>=0){let l=e===1?this.matchState.team1Roster:this.matchState.team2Roster;l[n].fouls++,e===1?this.matchState.team1Fouls++:this.matchState.team2Fouls++,this.fouledPlayers.add(i.playerNumber),yield this.handleFoulOutIfNeeded(e,l[n])}yield this.recordAction("Foul",i.playerNumber,0),this.quizState.setMatchState(this.matchState),this.selectedTeam1Chair=-1,this.selectedTeam2Chair=-1,this.updateDisplay()})}recordAction(e,t,i){return C(this,null,function*(){if(!this.matchState||!this.currentQuestion)return;let n=yield this.getNextSeqNum(),l={quizID:this.matchState.quizID,matchID:this.matchState.matchID,seqNum:n,questNum:this.questionNum,questType:this.matchState.bonusQuestion?"B":"P",questID:this.currentQuestion.questionID,tm1Player1:this.matchState.team1Chairs[0]?.playerNumber||0,tm1Player2:this.matchState.team1Chairs[1]?.playerNumber||0,tm1Player3:this.matchState.team1Chairs[2]?.playerNumber||0,tm1Player4:this.matchState.team1Chairs[3]?.playerNumber||0,tm2Player1:this.matchState.team2Chairs[0]?.playerNumber||0,tm2Player2:this.matchState.team2Chairs[1]?.playerNumber||0,tm2Player3:this.matchState.team2Chairs[2]?.playerNumber||0,tm2Player4:this.matchState.team2Chairs[3]?.playerNumber||0,actionPlayer:t,action:e,points:i,canceled:!1};yield this.dbService.addMatchDetail(l)})}getNextSeqNum(){return C(this,null,function*(){let e=yield this.dbService.getMatchDetails(this.matchState.quizID,this.matchState.matchID);return e.length===0?1:Math.max(...e.map(t=>t.seqNum))+1})}onNextQuestion(){return C(this,null,function*(){if(!this.matchState.finishQuest&&this.questionNum!==0&&!confirm("Current question was not finished. Do you wish to go to the next question?"))return;if(this.stopTimer(),this.matchState.bonusQuestion=!1,this.matchState.pendingBonusTeam=null,this.matchState.pendingBonusSeat=null,this.matchState.finishQuest=!1,this.selectedTeam1Chair=-1,this.selectedTeam2Chair=-1,this.questionAnswered=!1,this.fouledPlayers.clear(),this.matchState.team1Chairs.forEach(n=>{n&&(n.lastAnswerCorrect=null)}),this.matchState.team2Chairs.forEach(n=>{n&&(n.lastAnswerCorrect=null)}),this.questionNum===0){let n={quizID:this.matchState.quizID,matchID:this.matchState.matchID,team1:this.matchState.team1Team,team2:this.matchState.team2Team,score1:0,score2:0};yield this.dbService.saveMatchSummary(n)}this.questionNum++,this.matchState.questionNum=this.questionNum;let e=this.parms?.matchLength||20;if(this.availableQuestions.length===0&&(yield this.loadQuestionSet()),this.availableQuestions.length===0){alert("No more questions available in this set"),yield this.endMatch();return}let t=Math.floor(Math.random()*this.availableQuestions.length),i=this.availableQuestions[t];if(this.availableQuestions.splice(t,1),this.matchState.questionQueue){let n=this.matchState.questionQueue.findIndex(l=>l.questNum===i);n>=0&&this.matchState.questionQueue.splice(n,1)}if(this.matchState.questionHistory||(this.matchState.questionHistory=[]),this.matchState.questionHistory.push(i),this.matchState.questionIds=[...this.availableQuestions],this.quizState.setMatchState(V({},this.matchState)),this.matchState=this.quizState.getMatchState(),console.log(`Loading question ID ${i} (Question ${this.questionNum} of ${e})`),this.matchState.currentQuestionID=i,yield this.loadQuestion(i),this.questionNum>e)if(this.matchState.team1Score===this.matchState.team2Score)this.matchState.tieBreakNum++,alert(`The score is tied at ${this.matchState.team1Score}! Entering tie breaker ${this.matchState.tieBreakNum}.`);else{yield this.endMatch();return}this.quizState.setMatchState(this.matchState),this.updateDisplay()})}onReplayQuestion(){return C(this,null,function*(){if(!confirm("Replaying the question will void all results for the current question and use a backup question. Do you wish to continue?")||!this.matchState||!this.currentQuestion)return;let e=this.currentQuestion.questionID,t=yield this.dbService.getMatchDetails(this.matchState.quizID,this.matchState.matchID),i=new Set,n=new Set,l=new Set,h=new Set,S=new Map;for(let p of t.filter(u=>u.questNum===this.questionNum&&!u.canceled)){if(p.action==="Correct"){let u=this.matchState.team1Chairs.some(b=>b?.playerNumber===p.actionPlayer)?1:2,g=(u===1?this.matchState.team1Roster:this.matchState.team2Roster).find(b=>b.playerNumber===p.actionPlayer);u===1?this.matchState.team1Score-=p.points:this.matchState.team2Score-=p.points,g&&(g.correct=Math.max(0,g.correct-1),g.activeQuestions=Math.max(0,g.activeQuestions-1),g.quizOut&&this.settings&&g.correct<this.settings.quizOutCorrect&&(i.add(p.actionPlayer),this.settings.quizOutBonusPoints&&(u===1?this.matchState.team1Score-=this.settings.quizOutBonusPoints:this.matchState.team2Score-=this.settings.quizOutBonusPoints)))}else if(p.action==="Wrong"||p.action==="Foul"){let u=this.matchState.team1Chairs.some(b=>b?.playerNumber===p.actionPlayer)?1:this.matchState.team2Chairs.some(b=>b?.playerNumber===p.actionPlayer)?2:this.matchState.team1Roster.some(b=>b.playerNumber===p.actionPlayer)?1:2,g=(u===1?this.matchState.team1Roster:this.matchState.team2Roster).find(b=>b.playerNumber===p.actionPlayer);g&&(g.activeQuestions=Math.max(0,g.activeQuestions-1),p.action==="Wrong"?(g.errors=Math.max(0,g.errors-1),g.errorOut&&this.settings&&g.errors<this.settings.errorOutMisses&&(n.add(p.actionPlayer),this.settings.errorOutPenaltyPoints&&(u===1?this.matchState.team1Score+=Math.abs(this.settings.errorOutPenaltyPoints):this.matchState.team2Score+=Math.abs(this.settings.errorOutPenaltyPoints)))):p.action==="Foul"&&(g.fouls=Math.max(0,g.fouls-1),g.errorOut&&this.parms&&g.fouls<this.parms.foulOutNum&&(n.add(p.actionPlayer),this.parms.foulOutPoints&&(u===1?this.matchState.team1Score+=Math.abs(this.parms.foulOutPoints):this.matchState.team2Score+=Math.abs(this.parms.foulOutPoints)))))}else if(p.action.startsWith("Sub:")){h.add(p.actionPlayer);for(let u=0;u<4;u++){let T=this.matchState.team1Chairs[u],g=this.matchState.team2Chairs[u];if(T?.playerNumber===p.actionPlayer){let q=[p.tm1Player1,p.tm1Player2,p.tm1Player3,p.tm1Player4][u];q&&q!==p.actionPlayer&&(S.set(p.actionPlayer,{team:1,chairIndex:u,oldPlayer:q,newPlayer:p.actionPlayer}),l.add(q))}else if(g?.playerNumber===p.actionPlayer){let q=[p.tm2Player1,p.tm2Player2,p.tm2Player3,p.tm2Player4][u];q&&q!==p.actionPlayer&&(S.set(p.actionPlayer,{team:2,chairIndex:u,oldPlayer:q,newPlayer:p.actionPlayer}),l.add(q))}}}p.canceled=!0,yield this.dbService.addMatchDetail(p)}for(let p of i){let u=this.matchState.team1Roster.find(b=>b.playerNumber===p),T=this.matchState.team2Roster.find(b=>b.playerNumber===p),g=u||T;if(g){g.quizOut=!1,g.bonusOnly=!1;let b=u?1:2;this.updateChairStatus(b,g)}}for(let p of n){let u=this.matchState.team1Roster.find(b=>b.playerNumber===p),T=this.matchState.team2Roster.find(b=>b.playerNumber===p),g=u||T;if(g){g.errorOut=!1,g.bonusOnly=!1;let b=u?1:2;this.updateChairStatus(b,g)}}for(let[p,u]of S){let T=u.team===1?this.matchState.team1Chairs:this.matchState.team2Chairs,b=(u.team===1?this.matchState.team1Roster:this.matchState.team2Roster).find(q=>q.playerNumber===u.oldPlayer);b&&(T[u.chairIndex]={playerNumber:b.playerNumber,rosterPosition:u.chairIndex,name:b.nickname||b.name||`Player ${b.playerNumber}`,quizOut:b.quizOut,errorOut:b.errorOut,bonusOnly:b.bonusOnly})}if(this.availableQuestions.push(e),this.matchState.questionHistory){let p=this.matchState.questionHistory.indexOf(e);p>=0&&this.matchState.questionHistory.splice(p,1)}if(this.matchState.bonusQuestion=!1,this.matchState.finishQuest=!1,this.selectedTeam1Chair=-1,this.selectedTeam2Chair=-1,this.availableQuestions.length===0&&(yield this.loadQuestionSet()),this.availableQuestions.length===0){alert("No backup questions available in this set"),this.quizState.setMatchState(this.matchState),this.updateDisplay();return}let f=Math.floor(Math.random()*this.availableQuestions.length),M=this.availableQuestions[f];if(this.availableQuestions.splice(f,1),this.matchState.questionQueue){let p=this.matchState.questionQueue.findIndex(u=>u.questNum===M);p>=0&&this.matchState.questionQueue.splice(p,1)}this.matchState.questionHistory||(this.matchState.questionHistory=[]),this.matchState.questionHistory.push(M),this.matchState.questionIds=[...this.availableQuestions],yield this.loadQuestion(M),this.quizState.setMatchState(this.matchState),this.updateDisplay()})}onTimeout(e){return C(this,null,function*(){if(e===1){if(this.matchState.team1TOs<=0){alert(`${this.matchState.team1Team} has already used its last timeout.`);return}this.matchState.team1TOs--,this.timeoutTeamName=this.matchState.team1Team}else{if(this.matchState.team2TOs<=0){alert(`${this.matchState.team2Team} has already used its last timeout.`);return}this.matchState.team2TOs--,this.timeoutTeamName=this.matchState.team2Team}this.timeoutDuration=this.settings?.timeoutDurationSeconds||60,this.quizState.setMatchState(this.matchState),this.showTimeoutDialog=!0})}onTimeoutComplete(){this.showTimeoutDialog=!1}onSubstitute(e){return C(this,null,function*(){yield this.showSubstituteDialog(e)})}showSubstituteDialog(e,t=!1){return C(this,null,function*(){if(!this.matchState)return!1;let i=e===1?this.matchState.team1Team:this.matchState.team2Team,n=e===1?this.matchState.team1Chairs:this.matchState.team2Chairs,l=e===1?this.matchState.team1Roster:this.matchState.team2Roster,h=new Set;n.forEach(u=>{u&&u.playerNumber&&h.add(u.playerNumber)});let S=l.filter(u=>!h.has(u.playerNumber));if(S.length===0)return t||alert(`${i} has no available substitutes.`),!1;let f=[];if(n.forEach((u,T)=>{if(u&&u.playerNumber){let g=this.getRosterEntry(e,u.playerNumber);g&&(g.errorOut?f.push({chair:u,index:T,reason:"errored out"}):g.quizOut&&f.push({chair:u,index:T,reason:"quizzed out"}))}}),f.length===0&&t)return console.log("showSubstituteDialog: No players need substitution, returning early"),!1;console.log("showSubstituteDialog: Showing dialog",{needsSub:f,autoTrigger:t});let M=n.map((u,T)=>{if(!u||!u.playerNumber)return{index:T,displayName:"Empty",isEmpty:!0,playerNumber:0};let g=this.getRosterEntry(e,u.playerNumber),b="";return this.errorOutPlayers.has(u.playerNumber)||g?.errorOut?b="[ERRORED OUT]":(this.quizOutPlayers.has(u.playerNumber)||g?.quizOut)&&(b="[QUIZZED OUT]"),{index:T,displayName:u.name,isEmpty:!1,status:b,playerNumber:u.playerNumber}}),p=[];for(let u of S){let T=(u.nickname||u.name||"").trim();if(!T){let W=yield this.dbService.getPlayer(u.playerNumber);W&&(T=(W.nickname||W.name||"").trim())}let g="",q=this.matchState.matchSettings?.foulsToFoulOut||this.parms?.foulOutNum||2;u.quizOut?g="Quizzed Out":u.errorOut?g="Errored Out":u.fouls>=q&&(g="Fouled Out"),p.push({playerNumber:u.playerNumber,displayName:T?`#${u.playerNumber} ${T}`:`Player #${u.playerNumber}`,name:T||`Player #${u.playerNumber}`,status:g})}return this.subDialogTeam=e,this.subDialogTeamName=i,this.subDialogChairs=M,this.subDialogAvailableSubs=p,t&&f.length>0?(this.subDialogAutoChairIndex=f[0].index,this.subDialogAutoReason=f[0].reason):(this.subDialogAutoChairIndex=null,this.subDialogAutoReason=""),new Promise(u=>{this.subDialogResolve=u,this.showSubDialog=!0})})}onSubDialogConfirm(e){this.showSubDialog=!1;let t=this.subDialogAvailableSubs.find(i=>i.playerNumber===e.playerNumber);t?this.performSubstitution(this.subDialogTeam,e.chairIndex,e.playerNumber,t.name).then(()=>{this.subDialogResolve&&(this.subDialogResolve(!0),this.subDialogResolve=null)}):this.subDialogResolve&&(this.subDialogResolve(!1),this.subDialogResolve=null)}onSubDialogCancel(){this.showSubDialog=!1,this.subDialogResolve&&(this.subDialogResolve(!1),this.subDialogResolve=null)}onSwapDialogConfirm(e){this.showSubDialog=!1,this.performChairSwap(this.subDialogTeam,e.chairIndex1,e.chairIndex2).then(()=>{this.subDialogResolve&&(this.subDialogResolve(!0),this.subDialogResolve=null)})}performSubstitution(e,t,i,n){return C(this,null,function*(){if(!this.matchState)return;let l=e===1?this.matchState.team1Chairs:this.matchState.team2Chairs,S=l[t]?.name||"Empty seat";l[t]={playerNumber:i,rosterPosition:t,name:n,quizOut:!1,errorOut:!1,bonusOnly:!1},this.currentQuestion&&(yield this.recordAction(`Sub: ${S} \u2192 ${n}`,i,0)),this.quizState.setMatchState(this.matchState),alert(`Substitution: ${S} replaced by ${n}`)})}performChairSwap(e,t,i){return C(this,null,function*(){if(!this.matchState)return;let n=e===1?this.matchState.team1Chairs:this.matchState.team2Chairs,l=n[t],h=n[i];if(!l||!h){alert("Cannot swap: one or both chairs are empty.");return}let S=l.name,f=h.name,M=V({},l);n[t]={playerNumber:h.playerNumber,rosterPosition:t,name:h.name,quizOut:h.quizOut,errorOut:h.errorOut,bonusOnly:h.bonusOnly},n[i]={playerNumber:M.playerNumber,rosterPosition:i,name:M.name,quizOut:M.quizOut,errorOut:M.errorOut,bonusOnly:M.bonusOnly},this.currentQuestion&&(yield this.recordAction(`Swap: ${S} \u2194 ${f}`,l.playerNumber,0)),this.quizState.setMatchState(this.matchState),alert(`Chair Swap: ${S} (Chair ${t+1}) \u2194 ${f} (Chair ${i+1})`)})}onAppeal(e){return C(this,null,function*(){if(e===1){if(this.matchState.team1Appeals<=0){alert(`${this.matchState.team1Team} has already used all of their appeals.`);return}this.matchState.team1Appeals--,this.appealTeamName=this.matchState.team1Team}else{if(this.matchState.team2Appeals<=0){alert(`${this.matchState.team2Team} has already used all of their appeals.`);return}this.matchState.team2Appeals--,this.appealTeamName=this.matchState.team2Team}this.appealDuration=this.settings?.appealDurationSeconds||90,this.quizState.setMatchState(this.matchState),this.showAppealDialog=!0})}onAppealComplete(){this.showAppealDialog=!1}onEndMatch(){return C(this,null,function*(){confirm("This will end the match. Do you really want to end it?")&&(yield this.endMatch())})}endMatch(){return C(this,null,function*(){if(!this.matchState)return;let e={quizID:this.matchState.quizID,matchID:this.matchState.matchID,team1:this.matchState.team1Team,team2:this.matchState.team2Team,score1:this.matchState.team1Score,score2:this.matchState.team2Score};yield this.dbService.saveMatchSummary(e);for(let n of[...this.matchState.team1Roster,...this.matchState.team2Roster])yield this.dbService.saveMatchStats({playerNumber:n.playerNumber,quizID:this.matchState.quizID,matchID:this.matchState.matchID,activeQuestions:n.activeQuestions,correct:n.correct,errors:n.errors,fouls:n.fouls,bonusCorrect:n.bonusCorrect,bonusErrors:n.bonusErrors});let t="";this.matchState.team1Score>this.matchState.team2Score?t=`${this.matchState.team1Team} wins! By a score of ${this.matchState.team1Score} to ${this.matchState.team2Score}.`:this.matchState.team2Score>this.matchState.team1Score?t=`${this.matchState.team2Team} wins! By a score of ${this.matchState.team2Score} to ${this.matchState.team1Score}.`:t="The match is tied!",alert(`Congratulations! ${t}`);let i=sessionStorage.getItem("tournamentContext");if(i)try{let n=JSON.parse(i);if(n.tournamentId&&n.matchId){yield this.tournamentService.recordMatchResult(n.tournamentId,n.matchId,this.matchState.team1Score,this.matchState.team2Score,!0),sessionStorage.removeItem("tournamentContext"),this.quizState.resetMatch(),this.router.navigate(["/tournament",n.tournamentId]);return}}catch(n){console.error("Failed to update tournament:",n),sessionStorage.removeItem("tournamentContext")}this.quizState.resetMatch(),this.router.navigate(["/"])})}startTimer(){this.stopTimer(),this.timer=0,this.timerWarn=!1,this.timerExpired=!1,this.timerActive=!0,this.timerInterval=setInterval(()=>{this.timer++,this.updateTimerThresholds()},1e3)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.timer=0,this.timerActive=!1,this.timerWarn=!1,this.timerExpired=!1}getTimerDisplay(){if(this.timerExpired)return"TIME";let e=Math.floor(this.timer/60),t=this.timer%60;return`${e}:${t.toString().padStart(2,"0")}`}updateTimerThresholds(){let e=this.settings;e&&(!this.timerWarn&&this.timer>=e.speakWaitSeconds&&e.speakWaitSeconds>0&&(this.timerWarn=!0),!this.timerExpired&&this.timer>=e.answerTimeSeconds&&(this.timerExpired=!0,this.stopTimer(),this.timerExpired=!0,this.timerActive=!0))}getTeam1Color(){return this.quizState.getTeam1DarkColor()}getTeam2Color(){return this.quizState.getTeam2DarkColor()}onStartMatch(){this.router.navigate(["/select-question"])}getPlayerCorrect(e,t){if(!this.matchState)return 0;let n=(e===1?this.matchState.team1Roster:this.matchState.team2Roster).find(l=>l.playerNumber===t);return n?n.correct:0}getPlayerErrors(e,t){if(!this.matchState)return 0;let n=(e===1?this.matchState.team1Roster:this.matchState.team2Roster).find(l=>l.playerNumber===t);return n?n.errors:0}isPlayerFouled(e){return this.fouledPlayers.has(e)}toggleFlagQuestion(){if(!this.currentQuestion)return;let e=this.currentQuestion.questionID;this.flaggedQuestions.has(e)?(this.flaggedQuestions.delete(e),console.log(`Question ${e} unflagged for review`)):(this.flaggedQuestions.add(e),console.log(`Question ${e} flagged for review`)),sessionStorage.setItem("flaggedQuestions",JSON.stringify([...this.flaggedQuestions]))}isQuestionFlagged(){return this.currentQuestion?this.flaggedQuestions.has(this.currentQuestion.questionID):!1}getFlaggedQuestionsCount(){return this.flaggedQuestions.size}isPlayerQuizOut(e){return this.quizOutPlayers.has(e)}isPlayerErrorOut(e){return this.errorOutPlayers.has(e)}static \u0275fac=function(t){return new(t||a)(z(it),z(nt),z(tt),z(at))};static \u0275cmp=k({type:a,selectors:[["app-quiz-session"]],decls:5,vars:5,consts:[["preMatch",""],["class","quiz-session-container",4,"ngIf"],[3,"teamName","chairs","availableSubs","autoSubChairIndex","autoSubReason","confirmed","swapConfirmed","cancelled",4,"ngIf"],[3,"teamName","durationSeconds","completed",4,"ngIf"],[1,"quiz-session-container"],[1,"quiz-session-header"],[1,"question-info"],[1,"question-number"],["class","question-id",4,"ngIf"],[1,"set-name"],["class","btn btn-flag",3,"flagged","title","click",4,"ngIf"],["class","flagged-count",4,"ngIf"],[1,"btn","btn-secondary",3,"click"],[1,"match-layout"],[1,"match-left"],[4,"ngIf","ngIfElse"],[1,"action-section"],["class","timer-display",3,"ngClass",4,"ngIf"],["class","action-buttons",3,"no-player-selected",4,"ngIf"],[1,"navigation-buttons"],[1,"btn",3,"click"],["class","btn btn-secondary",3,"click",4,"ngIf"],[1,"match-right"],[1,"teams-section"],[1,"team-panel","team1"],[1,"team-header"],[1,"team-score"],[1,"chairs-section"],["class","chair-item",3,"selected","disabled","quiz-out","error-out","bonus-only","fouled-question","click",4,"ngFor","ngForOf"],[1,"team-actions"],[1,"btn","btn-small",3,"click"],[1,"team-panel","team2"],[1,"question-id"],[1,"btn","btn-flag",3,"click","title"],[1,"flagged-count"],[1,"question-section"],[1,"question-meta"],[1,"question-tags"],[1,"tag","type"],["class","tag id",4,"ngIf"],["class","tag reference",4,"ngIf"],[1,"question-columns"],[1,"question-card"],[1,"card-body","scrollable"],["class","verse-card",4,"ngIf"],[1,"tag","id"],[1,"tag","reference"],[1,"verse-card"],[1,"verse-header"],["class","card-body verse scrollable",4,"ngIf"],["class","verse-warning",4,"ngIf"],[1,"card-body","verse","scrollable"],[1,"verse-warning"],[1,"no-question-message"],[4,"ngIf"],["class","error-message",4,"ngIf"],["class","info-message",4,"ngIf"],[1,"error-message"],[1,"info-message"],[1,"timer-display",3,"ngClass"],[1,"timer-value"],["class","time-label",4,"ngIf"],["class","timer-hint",4,"ngIf"],[1,"time-label"],[1,"timer-hint"],[1,"action-buttons"],[1,"btn","btn-success",3,"click"],[1,"btn","btn-warning",3,"click"],[1,"btn","btn-danger",3,"click"],[1,"chair-item",3,"click"],[1,"chair-name"],["class","progress-indicators",4,"ngIf"],[1,"progress-indicators"],[1,"correct-progress"],[1,"progress-icon"],[1,"error-progress"],[1,"no-match-message"],[3,"confirmed","swapConfirmed","cancelled","teamName","chairs","availableSubs","autoSubChairIndex","autoSubReason"],[3,"completed","teamName","durationSeconds"]],template:function(t,i){t&1&&v(0,Gt,66,32,"div",1)(1,Kt,8,0,"div",1)(2,Xt,1,5,"app-substitution-dialog",2)(3,Yt,1,2,"app-timeout-dialog",3)(4,te,1,2,"app-appeal-dialog",3),t&2&&(d("ngIf",i.matchState),s(),d("ngIf",!i.matchState),s(),d("ngIf",i.showSubDialog),s(),d("ngIf",i.showTimeoutDialog),s(),d("ngIf",i.showAppealDialog))},dependencies:[D,Y,A,Q,et,F,B,L],styles:['.quiz-session-container[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column;gap:var(--spacing-lg);background:linear-gradient(135deg,var(--xl-gray-light) 0%,var(--xl-white) 100%);padding:var(--spacing-lg)}.quiz-session-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:var(--spacing-lg);background:var(--xl-white);padding:var(--spacing-md) var(--spacing-lg);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);border:1px solid var(--xl-gray)}.question-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-md);flex-wrap:wrap}.question-number[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--xl-blue-dark);font-family:var(--font-heading)}.question-id[_ngcontent-%COMP%]{font-size:.9rem;color:var(--xl-gray-medium);background:var(--xl-gray-light);padding:.25rem .75rem;border-radius:var(--radius-sm)}.set-name[_ngcontent-%COMP%]{font-size:.95rem;color:var(--xl-gray-dark);font-weight:600}.question-section[_ngcontent-%COMP%]{background:var(--xl-white);border-radius:var(--radius-lg);padding:var(--spacing-md) var(--spacing-lg);box-shadow:var(--shadow-lg);border:1px solid var(--xl-gray);display:flex;flex-direction:column;gap:var(--spacing-md);min-height:0}.question-meta[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:var(--spacing-md)}.intro-line[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:var(--xl-blue-dark)}.question-tags[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-xs);flex-wrap:wrap}.tag[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:.25rem .75rem;border-radius:999px;font-size:.85rem;font-weight:600;background:var(--xl-gray-light);color:var(--xl-gray-dark);text-transform:uppercase;letter-spacing:.03em}.tag.type[_ngcontent-%COMP%]{background:var(--xl-blue-light);color:var(--xl-blue-dark)}.tag.reference[_ngcontent-%COMP%]{background:var(--xl-gold-light);color:var(--xl-gold-dark)}.tag.id[_ngcontent-%COMP%]{background:var(--xl-gray-medium);color:var(--xl-white)}.question-columns[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:var(--spacing-md)}.question-card[_ngcontent-%COMP%], .verse-card[_ngcontent-%COMP%]{background:var(--xl-white);border-radius:var(--radius-md);border:1px solid var(--xl-gray-light);box-shadow:var(--shadow-md);padding:var(--spacing-sm) var(--spacing-md);display:flex;flex-direction:column;gap:var(--spacing-sm);min-height:0}.question-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .verse-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1rem;font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:var(--xl-gray-dark)}.card-body[_ngcontent-%COMP%]{font-size:1rem;line-height:1.6;font-family:var(--font-primary);color:var(--xl-black);white-space:pre-wrap}.card-body.scrollable[_ngcontent-%COMP%]{max-height:170px;overflow-y:auto;padding-right:var(--spacing-sm)}.verse-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,rgba(255,215,128,.18) 0%,var(--xl-white) 100%);border-color:var(--xl-gold-light)}.verse-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{font-family:Georgia,Times New Roman,serif}.verse-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:var(--spacing-sm)}.verse-warning[_ngcontent-%COMP%]{padding:var(--spacing-sm) var(--spacing-md);border-radius:var(--radius-sm);background:#ffc8784d;color:var(--xl-gold-dark);font-weight:600}.teams-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:var(--spacing-md)}.team-panel[_ngcontent-%COMP%]{border-radius:var(--radius-lg);padding:var(--spacing-md) var(--spacing-lg);box-shadow:var(--shadow-lg);border:2px solid rgba(255,255,255,.35);display:flex;flex-direction:column;gap:var(--spacing-md);min-height:0}.team-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:var(--spacing-md)}.team-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.4rem;color:var(--xl-black);margin:0;font-weight:700;font-family:var(--font-heading)}.team-score[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:var(--spacing-xs);font-weight:700;font-size:1.1rem;background:#ffffff59;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--radius-sm)}.chairs-section[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:var(--spacing-xs)}.chair-item[_ngcontent-%COMP%]{padding:var(--spacing-xs) var(--spacing-md);background:#ffffffd9;border-radius:var(--radius-md);cursor:pointer;transition:all var(--transition-base);border:1px solid transparent;font-weight:600;display:flex;align-items:center}.chair-item[_ngcontent-%COMP%]:hover{background:#fffffff2;border-color:var(--xl-blue)}.chair-item.selected[_ngcontent-%COMP%]{background:var(--xl-white);border-color:var(--xl-blue-dark);box-shadow:0 0 0 3px #3b82f633}.chair-item.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.chair-item.quiz-out[_ngcontent-%COMP%]{border-color:var(--xl-gold-dark)}.chair-item.quiz-out[_ngcontent-%COMP%]:after{content:"Quiz Out";display:inline-block;margin-left:var(--spacing-xs);padding:0 var(--spacing-xs);font-size:.7rem;background:var(--xl-gold-light);border-radius:var(--radius-sm);color:var(--xl-gold-dark)}.chair-item.error-out[_ngcontent-%COMP%]{border-color:var(--xl-red-dark);background:#ff808026}.chair-item.error-out[_ngcontent-%COMP%]:after{content:"Error Out";display:inline-block;margin-left:var(--spacing-xs);padding:0 var(--spacing-xs);font-size:.7rem;background:#ff808066;border-radius:var(--radius-sm);color:var(--xl-red-dark)}.chair-item.bonus-only[_ngcontent-%COMP%]:not(.error-out):after{content:"Bonus Only";display:inline-block;margin-left:var(--spacing-xs);padding:0 var(--spacing-xs);font-size:.7rem;background:#3b82f633;border-radius:var(--radius-sm);color:var(--xl-blue-dark)}.chair-item.fouled-question[_ngcontent-%COMP%]{border-color:var(--xl-gold);background:#f59e0b26;opacity:.7}.chair-item.fouled-question[_ngcontent-%COMP%]:after{content:"Fouled";display:inline-block;margin-left:var(--spacing-xs);padding:0 var(--spacing-xs);font-size:.7rem;background:#f59e0b66;border-radius:var(--radius-sm);color:var(--xl-gold-dark)}.team-actions[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-xs);flex-wrap:wrap}.action-section[_ngcontent-%COMP%]{background:var(--xl-white);border-radius:var(--radius-lg);padding:var(--spacing-md) var(--spacing-lg);box-shadow:var(--shadow-lg);border:1px solid var(--xl-gray);display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:var(--spacing-lg);align-items:center;margin-top:auto}.timer-display[_ngcontent-%COMP%]{text-align:center;font-size:1.75rem;font-weight:700;color:var(--xl-blue-dark);font-family:Courier New,monospace;background:linear-gradient(135deg,var(--xl-blue-lighter) 0%,var(--xl-white) 100%);padding:var(--spacing-md) var(--spacing-lg);border-radius:var(--radius-md);border:2px solid var(--xl-blue);display:flex;flex-direction:column;gap:var(--spacing-xs);justify-content:center;align-items:center}.timer-display.warning[_ngcontent-%COMP%]{border-color:var(--xl-gold-dark);color:var(--xl-gold-dark)}.timer-display.expired[_ngcontent-%COMP%]{border-color:#dc3545;color:#dc3545;background:linear-gradient(135deg,#fcc,#ffe6e6);animation:_ngcontent-%COMP%_pulse-urgent .5s ease-in-out infinite alternate;box-shadow:0 0 20px #dc354566}@keyframes _ngcontent-%COMP%_pulse-urgent{0%{transform:scale(1);box-shadow:0 0 20px #dc354566}to{transform:scale(1.02);box-shadow:0 0 30px #dc354599}}.timer-value[_ngcontent-%COMP%]{font-size:2rem}.time-label[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:900;letter-spacing:.2em;text-transform:uppercase;color:#dc3545;text-shadow:2px 2px 4px rgba(220,53,69,.3);animation:_ngcontent-%COMP%_flash-time .3s ease-in-out infinite alternate}@keyframes _ngcontent-%COMP%_flash-time{0%{opacity:1}to{opacity:.7}}.timer-hint[_ngcontent-%COMP%]{font-size:.85rem;font-family:var(--font-primary);color:var(--xl-gray-dark)}.btn.disabled-fade[_ngcontent-%COMP%]{opacity:.4;cursor:not-allowed;pointer-events:none;filter:grayscale(50%)}.action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:var(--spacing-sm)}.action-buttons.no-player-selected[_ngcontent-%COMP%]{opacity:.4;filter:grayscale(40%)}.action-buttons.no-player-selected[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{cursor:not-allowed}.navigation-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-sm);flex-wrap:wrap}.no-question-message[_ngcontent-%COMP%]{text-align:center;color:var(--xl-gray-dark)}.error-message[_ngcontent-%COMP%]{color:var(--xl-red-dark);font-weight:600}.info-message[_ngcontent-%COMP%]{color:var(--xl-green-dark);font-weight:600}.match-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(0,1.4fr) minmax(0,1fr);gap:var(--spacing-lg);flex:1;min-height:0}.match-left[_ngcontent-%COMP%], .match-right[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-lg);min-height:0}.match-right[_ngcontent-%COMP%]{justify-content:stretch}.match-right[_ngcontent-%COMP%]   .teams-section[_ngcontent-%COMP%], .match-right[_ngcontent-%COMP%]   .team-panel[_ngcontent-%COMP%]{flex:1}.match-right[_ngcontent-%COMP%]   .team-panel[_ngcontent-%COMP%] + .team-panel[_ngcontent-%COMP%]{margin-top:var(--spacing-md)}@media (max-width: 1280px){.match-layout[_ngcontent-%COMP%]{grid-template-columns:1fr}.match-right[_ngcontent-%COMP%]{order:1}}@media (max-width: 968px){.teams-section[_ngcontent-%COMP%]{grid-template-columns:1fr}.action-buttons[_ngcontent-%COMP%]{flex-direction:column}.action-buttons[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}.answer-indicator[_ngcontent-%COMP%]{display:inline-block;margin-left:var(--spacing-sm);font-size:1.2rem;font-weight:700}.answer-indicator.correct[_ngcontent-%COMP%]{color:var(--xl-green-dark)}.answer-indicator.incorrect[_ngcontent-%COMP%]{color:var(--xl-red-dark)}.chair-name[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;flex:1;min-width:0}.chair-name[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.progress-indicators[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-xs);margin-left:var(--spacing-sm);flex-shrink:0}.correct-progress[_ngcontent-%COMP%], .error-progress[_ngcontent-%COMP%]{display:flex;gap:2px;align-items:center}.progress-icon[_ngcontent-%COMP%]{font-size:.8rem;opacity:.25;color:var(--xl-gray-dark);transition:all var(--transition-base);line-height:1}.correct-progress[_ngcontent-%COMP%]   .progress-icon.filled[_ngcontent-%COMP%]{color:var(--xl-green-dark);opacity:1;font-weight:700}.error-progress[_ngcontent-%COMP%]   .progress-icon.filled[_ngcontent-%COMP%]{color:var(--xl-red-dark);opacity:1;font-weight:700}@keyframes _ngcontent-%COMP%_pulse-attention{0%{box-shadow:0 0 #3b82f6b3;transform:scale(1)}50%{box-shadow:0 0 0 10px #3b82f600;transform:scale(1.05)}to{box-shadow:0 0 #3b82f600;transform:scale(1)}}.btn.attention[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse-attention 1.5s infinite;background:var(--xl-blue)!important;color:var(--xl-white)!important;border-color:var(--xl-blue-dark)!important}.btn-flag[_ngcontent-%COMP%]{padding:.25rem .75rem;font-size:.85rem;background:var(--xl-gray-light);color:var(--xl-gray-dark);border:1px solid var(--xl-gray);border-radius:var(--radius-sm);cursor:pointer;transition:all .2s ease}.btn-flag[_ngcontent-%COMP%]:hover{background:#fef3c7;border-color:#f59e0b}.btn-flag.flagged[_ngcontent-%COMP%]{background:#fef3c7;color:#b45309;border-color:#f59e0b;font-weight:600}.flagged-count[_ngcontent-%COMP%]{font-size:.85rem;color:#b45309;font-weight:500}.question-number.bonus-active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;padding:.25rem .75rem;border-radius:var(--radius-sm);animation:_ngcontent-%COMP%_bonus-pulse 1s infinite}@keyframes _ngcontent-%COMP%_bonus-pulse{0%,to{box-shadow:0 0 #f59e0b80}50%{box-shadow:0 0 0 8px #f59e0b00}}']})};export{rt as QuizSessionComponent};
